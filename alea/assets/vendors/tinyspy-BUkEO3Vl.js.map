{"version":3,"file":"tinyspy-BUkEO3Vl.js","sources":["../../../node_modules/.pnpm/tinyspy@2.2.1/node_modules/tinyspy/dist/index.js"],"sourcesContent":["// src/utils.ts\nfunction R(e, t) {\n  if (!e)\n    throw new Error(t);\n}\nfunction u(e, t) {\n  return typeof t === e;\n}\nfunction b(e) {\n  return e instanceof Promise;\n}\nfunction f(e, t, n) {\n  Object.defineProperty(e, t, n);\n}\nfunction i(e, t, n) {\n  Object.defineProperty(e, t, { value: n });\n}\n\n// src/constants.ts\nvar c = Symbol.for(\"tinyspy:spy\");\n\n// src/internal.ts\nvar g = /* @__PURE__ */ new Set(), C = (e) => {\n  e.called = !1, e.callCount = 0, e.calls = [], e.results = [], e.next = [];\n}, M = (e) => (f(e, c, { value: { reset: () => C(e[c]) } }), e[c]), A = (e) => e[c] || M(e);\nfunction I(e) {\n  R(u(\"function\", e) || u(\"undefined\", e), \"cannot spy on a non-function value\");\n  let t = function(...s) {\n    let r = A(t);\n    r.called = !0, r.callCount++, r.calls.push(s);\n    let m = r.next.shift();\n    if (m) {\n      r.results.push(m);\n      let [l, o] = m;\n      if (l === \"ok\")\n        return o;\n      throw o;\n    }\n    let p, d = \"ok\";\n    if (r.impl)\n      try {\n        new.target ? p = Reflect.construct(r.impl, s, new.target) : p = r.impl.apply(this, s), d = \"ok\";\n      } catch (l) {\n        throw p = l, d = \"error\", r.results.push([d, l]), l;\n      }\n    let a = [d, p];\n    if (b(p)) {\n      let l = p.then((o) => a[1] = o).catch((o) => {\n        throw a[0] = \"error\", a[1] = o, o;\n      });\n      Object.assign(l, p), p = l;\n    }\n    return r.results.push(a), p;\n  };\n  i(t, \"_isMockFunction\", !0), i(t, \"length\", e ? e.length : 0), i(t, \"name\", e && e.name || \"spy\");\n  let n = A(t);\n  return n.reset(), n.impl = e, t;\n}\nfunction v(e) {\n  let t = A(e);\n  f(e, \"returns\", {\n    get: () => t.results.map(([, n]) => n)\n  }), [\"called\", \"callCount\", \"results\", \"calls\", \"reset\", \"impl\"].forEach((n) => f(e, n, { get: () => t[n], set: (s) => t[n] = s })), i(e, \"nextError\", (n) => (t.next.push([\"error\", n]), t)), i(e, \"nextResult\", (n) => (t.next.push([\"ok\", n]), t));\n}\n\n// src/spy.ts\nfunction z(e) {\n  let t = I(e);\n  return v(t), t;\n}\n\n// src/spyOn.ts\nvar k = (e, t) => Object.getOwnPropertyDescriptor(e, t), P = (e, t) => {\n  t != null && typeof t == \"function\" && t.prototype != null && Object.setPrototypeOf(e.prototype, t.prototype);\n};\nfunction E(e, t, n) {\n  R(!u(\"undefined\", e), \"spyOn could not find an object to spy upon\"), R(u(\"object\", e) || u(\"function\", e), \"cannot spyOn on a primitive value\");\n  let [s, r] = (() => {\n    if (!u(\"object\", t))\n      return [t, \"value\"];\n    if (\"getter\" in t && \"setter\" in t)\n      throw new Error(\"cannot spy on both getter and setter\");\n    if (\"getter\" in t)\n      return [t.getter, \"get\"];\n    if (\"setter\" in t)\n      return [t.setter, \"set\"];\n    throw new Error(\"specify getter or setter to spy on\");\n  })(), m = k(e, s), p = Object.getPrototypeOf(e), d = p && k(p, s), a = m || d;\n  R(a || s in e, `${String(s)} does not exist`);\n  let l = !1;\n  r === \"value\" && a && !a.value && a.get && (r = \"get\", l = !0, n = a.get());\n  let o;\n  a ? o = a[r] : r !== \"value\" ? o = () => e[s] : o = e[s], n || (n = o);\n  let y = I(n);\n  r === \"value\" && P(y, o);\n  let O = (h) => {\n    let { value: G, ...w } = a || {\n      configurable: !0,\n      writable: !0\n    };\n    r !== \"value\" && delete w.writable, w[r] = h, f(e, s, w);\n  }, K = () => a ? f(e, s, a) : O(o), T = y[c];\n  return i(T, \"restore\", K), i(T, \"getOriginal\", () => l ? o() : o), i(T, \"willCall\", (h) => (T.impl = h, y)), O(l ? () => (P(y, n), y) : y), g.add(y), y;\n}\nfunction W(e, t, n) {\n  let s = E(e, t, n);\n  return v(s), [\"restore\", \"getOriginal\", \"willCall\"].forEach((r) => {\n    i(s, r, s[c][r]);\n  }), s;\n}\n\n// src/restoreAll.ts\nfunction Z() {\n  for (let e of g)\n    e.restore();\n  g.clear();\n}\nexport {\n  I as createInternalSpy,\n  A as getInternalState,\n  E as internalSpyOn,\n  Z as restoreAll,\n  g as spies,\n  z as spy,\n  W as spyOn\n};\n"],"names":["R","e","t","u","b","f","n","i","c","g","C","M","A","I","s","m","l","o","p","d","a","k","E","y","h","G","w","K","T"],"mappings":"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","x_google_ignoreList":[0]}
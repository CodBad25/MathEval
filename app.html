<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Correcteur Universel - DNB</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/contrib/auto-render.min.js"></script>
    <!-- Scratchblocks pour rendu des blocs Scratch -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/scratchblocks@3.6.4/build/scratchblocks.min.css">
    <script src="https://cdn.jsdelivr.net/npm/scratchblocks@3.6.4/build/scratchblocks.min.js"></script>
    <script src="js/data/dictionnaireDNB.js?v=20251105004"></script>
    <script src="js/data/dictionnaireAutomatismes.js?v=20251105004"></script>
    <script src="js/modules/mathaleaUtils.js?v=20251105004"></script>
    <script src="js/modules/generateursAutomatismes.js?v=20251105004"></script>
    <!-- MathAL√âA Integration via RPC (comme Capytale) -->
    <script type="module" src="js/rpc-wrapper.js"></script>
    <link rel="stylesheet" href="css/main.css?v=20251106002">
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        .top-bar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            flex-shrink: 0;
        }
        .top-bar h1 {
            color: white;
            font-size: 1.2em;
            margin: 0;
        }
        .top-bar button {
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: background 0.2s;
            margin-left: 10px;
        }
        .top-bar button:hover {
            background: rgba(255,255,255,0.3);
        }
        .top-bar-buttons {
            display: flex;
            gap: 10px;
        }
        #contentWrapper {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
        }
    </style>
</head>
<body>
    <!-- Barre sup√©rieure compacte -->
    <div class="top-bar">
        <h1>üìö Correcteur Universel - DNB</h1>
        <div class="top-bar-buttons">
            <button onclick="window.location.href='index.html'">‚Üê Retour √† l'accueil</button>
            <button onclick="toggleParametresPanel()" id="parametresBtnHeader">üéõÔ∏è Param√®tres</button>
            <button onclick="toggleAdminPanel()" id="adminToggleBtnHeader">‚öôÔ∏è Admin</button>
        </div>
    </div>

    <!-- Wrapper pour le contenu scrollable -->
    <div id="contentWrapper">
    <div class="container">
        <!-- === PAGE DE S√âLECTION AUTOMATISMES (Exercice 1) === -->
        <div class="dnb-selection-page" id="automatismesSelectionPage" style="display: none;">
            <div class="page-header" style="background: white; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                <h2 style="color: #2c3e50; margin-bottom: 10px;">üéØ S√©lection des automatismes (Exercice 1 - 6 points)</h2>
                <p style="color: #666;">Choisissez les questions d'automatismes depuis MathAL√âA pour composer votre exercice 1</p>
            </div>

            <!-- Barre de s√©lection sticky -->
            <div class="selection-bar" id="automatismesSelectionBar">
                <div class="selection-info">
                    <span id="automatismesCount">0 automatisme s√©lectionn√©</span>
                    <span style="margin: 0 15px; color: #666;">|</span>
                    <span id="automatismesPoints">Total: 0 / 6 points</span>
                </div>
                <button class="btn btn-primary" id="btnContinueAutomatismes" onclick="continueFromAutomatismes()">
                    Continuer avec les exercices DNB ‚Üí
                </button>
            </div>

            <!-- Aper√ßu Exercice 1 -->
            <div id="exercice1Preview" style="background: white; padding: 20px; border-radius: 12px; margin-bottom: 20px; border: 2px solid #4285f4; display: none;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h3 style="color: #2c3e50; margin: 0;">üìù Aper√ßu Exercice 1 - Automatismes</h3>
                    <button onclick="toggleExercice1Preview()" style="padding: 5px 10px; background: #6c757d; color: white; border: none; border-radius: 6px; cursor: pointer;">
                        <span id="previewToggleText">‚ñº</span>
                    </button>
                </div>
                <div id="exercice1PreviewContent" style="max-height: 400px; overflow-y: auto; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                    <p style="color: #666; font-style: italic;">S√©lectionnez des automatismes pour voir l'aper√ßu de l'exercice 1...</p>
                </div>
            </div>

            <!-- Filtres et recherche -->
            <div style="background: white; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                <div style="display: flex; gap: 15px; align-items: center; flex-wrap: wrap;">
                    <input type="text" id="searchAutomatismes" placeholder="üîç Rechercher par titre, id..." 
                           style="flex: 1; min-width: 250px; padding: 10px; border: 2px solid #dee2e6; border-radius: 8px; font-size: 14px;"
                           oninput="filterAutomatismes()">
                    
                    <select id="categorieFilterAutomatismes" 
                            style="padding: 10px; border: 2px solid #dee2e6; border-radius: 8px; font-size: 14px; cursor: pointer;"
                            onchange="filterAutomatismes()">
                        <option value="">Toutes les cat√©gories</option>
                        <option value="3AutoN">Nombres et calculs</option>
                        <option value="3AutoG">G√©om√©trie</option>
                        <option value="3AutoP">Proportionnalit√©/Probabilit√©s</option>
                        <option value="3AutoI">Informatique</option>
                    </select>
                    
                    <button class="btn btn-secondary" onclick="clearAutomatismesFilters()" style="white-space: nowrap;">
                        Effacer les filtres
                    </button>
                </div>
            </div>

            <!-- Grille des automatismes -->
            <div id="automatismesGrid" class="exercises-grid"></div>
        </div>

        <!-- === PAGE DE S√âLECTION DNB === -->
        <div class="dnb-selection-page" id="dnbSelectionPage">
            <div class="page-header" style="background: white; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                <h2 style="color: #2c3e50; margin-bottom: 10px;">üìö S√©lection des exercices DNB</h2>
                <p style="color: #666;">Choisissez les exercices depuis la base MathAL√âA pour composer votre sujet</p>
            </div>

            <!-- Barre de s√©lection sticky -->
            <div class="selection-bar" id="selectionBar">
                <div class="selection-info">
                    <span id="selectionCount">0 exercice s√©lectionn√©</span>
                </div>
                <button class="btn-continue" id="btnContinue" onclick="continueToSetup()" disabled>
                    Continuer avec les exercices s√©lectionn√©s ‚Üí
                </button>
            </div>

            <!-- Filtres -->
            <div class="filters-section">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h3 style="color: #2c3e50; margin: 0;">Filtres</h3>
                    <button id="btnClearFilters" onclick="clearAllFilters()" style="
                        padding: 8px 16px;
                        background: #dc3545;
                        color: white;
                        border: none;
                        border-radius: 6px;
                        cursor: pointer;
                        font-size: 13px;
                        display: none;
                        transition: all 0.2s;
                    " onmouseover="this.style.background='#c82333'" onmouseout="this.style.background='#dc3545'">
                        üóëÔ∏è R√©initialiser les filtres
                    </button>
                </div>
                <div class="filters-grid">
                    <div class="filter-group">
                        <label for="filterYear">Ann√©e</label>
                        <select id="filterYear" onchange="applyFilters()">
                            <option value="">Toutes les ann√©es</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="filterTheme">Th√®me</label>
                        <select id="filterTheme" onchange="applyFilters()">
                            <option value="">Tous les th√®mes</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="filterSearch">Recherche intelligente</label>
                        <div style="position: relative;">
                            <input type="text" id="filterSearch" placeholder="Ex: pythagore, 2013 proba, asie+pondichery..." oninput="applyFilters()" style="width: 100%; padding-right: 35px;">
                            <button id="btnClearSearch" onclick="clearSearch()" style="
                                position: absolute;
                                right: 5px;
                                top: 50%;
                                transform: translateY(-50%);
                                background: #6c757d;
                                color: white;
                                border: none;
                                border-radius: 50%;
                                width: 24px;
                                height: 24px;
                                cursor: pointer;
                                font-size: 16px;
                                line-height: 1;
                                display: none;
                                transition: all 0.2s;
                            " onmouseover="this.style.background='#5a6268'" onmouseout="this.style.background='#6c757d'">
                                √ó
                            </button>
                        </div>
                        <small style="display: block; margin-top: 5px; color: #666; font-size: 0.85em;">
                            Utilisez + pour OU (ex: asie+pondichery), espace pour ET (ex: 2013 proba)
                        </small>
                    </div>
                </div>
                <div id="filterResults" style="margin-top: 15px; color: #666; font-size: 14px; font-weight: 500;"></div>
                <div id="activeFiltersIndicator" style="
                    margin-top: 10px;
                    padding: 12px;
                    background: #fff3cd;
                    border-left: 4px solid #ffc107;
                    border-radius: 6px;
                    display: none;
                    font-size: 14px;
                    color: #856404;
                ">
                    ‚ö†Ô∏è <strong>Filtres actifs :</strong> <span id="activeFiltersList"></span>
                </div>
            </div>

            <!-- Grille d'exercices -->
            <div class="exercises-grid" id="exercisesGrid"></div>
        </div>

        <!-- Modal de pr√©visualisation -->
        <div class="preview-modal" id="previewModal">
            <div class="preview-content">
                <button class="preview-close" onclick="closePreview()">√ó</button>
                <div id="previewBody"></div>
            </div>
        </div>

        <!-- === PAGE MATHAL√âA (IFRAME + RPC) === -->
        <div class="dnb-selection-page" id="mathaleaPage" style="display: none;">
            <div class="page-header" style="background: white; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                <h2 style="color: #2c3e50; margin-bottom: 10px;">üéì S√©lection d'exercices MathAL√âA</h2>
                <p style="color: #666;">S√©lectionnez vos exercices directement depuis MathAL√âA</p>

                <!-- Configuration source MathAL√âA -->
                <div style="margin-top: 15px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                    <label style="display: flex; align-items: center; gap: 10px; font-weight: 500;">
                        <span>Source MathAL√âA:</span>
                        <select id="mathaleaSourceSelect" onchange="updateMathaleaSource()" style="padding: 8px; border: 2px solid #dee2e6; border-radius: 6px;">
                            <option value="prod">Production (coopmaths.fr)</option>
                            <option value="local" selected>Local (localhost:8080)</option>
                        </select>
                    </label>
                </div>
            </div>

            <!-- Iframe MathAL√âA (cr√©√© dynamiquement pour √©viter chargement pr√©matur√©) -->
            <div id="mathaleaFrameContainer" style="background: white; padding: 10px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                <!-- L'iframe sera ins√©r√© ici dynamiquement par initMathaleaPage() -->
            </div>

            <!-- Actions -->
            <div style="margin-top: 20px; display: flex; gap: 15px; justify-content: center;">
                <button onclick="retourAccueil()" class="btn btn-secondary">
                    ‚Üê Retour √† l'accueil
                </button>
                <button onclick="validerSelectionMathALEA()" class="btn btn-primary">
                    Valider la s√©lection ‚Üí
                </button>
            </div>
        </div>

        <!-- === PAGE DE CONCEPTION DU BAR√àME === -->
        <div class="main-page" id="baremeDesignPage">
            <div class="page-header" style="background: white; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                <h2 style="color: #2c3e50; margin-bottom: 10px;">‚öñÔ∏è Conception du bar√®me</h2>
                <p style="color: #666;">D√©finissez les comp√©tences et les points pour chaque exercice</p>
                <button onclick="goBackToSelection()" style="margin-top: 10px; padding: 8px 16px; background: #6c757d; color: white; border: none; border-radius: 6px; cursor: pointer;">
                    ‚Üê Retour √† la s√©lection
                </button>
            </div>

            <!-- Indicateur de total -->
            <div id="totalPointsIndicator" style="position: sticky; top: 80px; z-index: 100; background: white; padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 2px solid #dee2e6; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                <div style="display: flex; justify-content: space-between; align-items: start; gap: 20px;">
                    <div style="flex: 1;">
                        <div style="margin-bottom: 10px;">
                            <strong style="font-size: 1.1em;">Total du bar√®me :</strong>
                            <span id="currentTotal" style="font-size: 1.3em; font-weight: bold; color: #28a745; margin-left: 10px;">0</span>
                            <span style="font-size: 1.1em; color: #666;"> / 20 points</span>
                        </div>
                        <div id="totalDetails" style="padding-left: 10px; border-left: 3px solid #e0e0e0;">
                            <!-- D√©tail par exercice g√©n√©r√© dynamiquement -->
                        </div>
                        <div id="competencesSummary" style="margin-top: 15px; padding-top: 15px; border-top: 2px solid #e9ecef;">
                            <strong style="display: block; margin-bottom: 8px; color: #2c3e50;">üìä Comp√©tences √©valu√©es :</strong>
                            <div id="competencesSummaryContent" style="display: flex; flex-wrap: wrap; gap: 8px; max-height: 80px; overflow-y: auto; padding-right: 10px;">
                                <!-- R√©sum√© des comp√©tences g√©n√©r√© dynamiquement -->
                            </div>
                        </div>
                    </div>
                    <button onclick="continueToCandidates()" id="btnContinueToCandidates" class="btn-continue" disabled style="flex-shrink: 0;">
                        Continuer vers les candidats ‚Üí
                    </button>
                </div>
                <div id="totalWarning" style="margin-top: 10px; display: none; padding: 10px; background: #fff3cd; border: 1px solid #ffc107; border-radius: 6px; color: #856404;">
                    ‚ö†Ô∏è Le total d√©passe 100 points
                </div>
            </div>

            <!-- Onglets des exercices -->
            <div id="baremeExerciseTabs" style="display: flex; gap: 8px; margin-bottom: 20px; flex-wrap: wrap; background: white; padding: 12px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                <!-- Les onglets seront g√©n√©r√©s dynamiquement -->
            </div>

            <!-- Conteneur du contenu de l'exercice s√©lectionn√© -->
            <div id="baremeExerciseContent" style="background: white; border-radius: 12px; padding: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); max-height: 60vh; overflow-y: auto;">
                <!-- Le contenu de l'exercice s√©lectionn√© sera g√©n√©r√© ici -->
            </div>
        </div>

        <!-- === PAGE DE CONFIGURATION === -->
        <div class="setup-page" id="setupPage" style="display: none;">
            <div class="setup-card">
                <div class="setup-title">
                    üë• S√©lection des candidats
                </div>
                
                <p style="background: #e3f2fd; padding: 12px; border-radius: 6px; margin-bottom: 15px; color: #1565c0; font-size: 0.9em;">
                    <strong>Information :</strong> Choisissez votre m√©thode de s√©lection des candidats. 
                    √Ä l'√©tape suivante, vous pourrez √©liminer ceux qui ne font pas partie de votre paquet.
                </p>

                <!-- Onglets de m√©thode de s√©lection -->
                <div style="display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 2px solid #e0e0e0;">
                    <button id="tabManual" class="candidate-tab active" onclick="switchCandidateTab('manual')">
                        ‚úèÔ∏è Saisie manuelle
                    </button>
                    <button id="tabCsv" class="candidate-tab" onclick="switchCandidateTab('csv')">
                        üìÑ Import CSV
                    </button>
                </div>

                <!-- M√©thode 1 : Saisie manuelle -->
                <div id="manualInput" class="candidate-method">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="startNumber">Num√©ro de d√©but</label>
                            <input type="number" id="startNumber" placeholder="Ex: 150" value="150">
                        </div>
                        <div class="form-group">
                            <label for="endNumber">Num√©ro de fin</label>
                            <input type="number" id="endNumber" placeholder="Ex: 170" value="170">
                        </div>
                    </div>

                    <div class="candidates-preview" id="candidatesPreview">
                        Aper√ßu : 21 candidats (150 √† 170)
                    </div>
                </div>

                <!-- M√©thode 2 : Import CSV -->
                <div id="csvInput" class="candidate-method" style="display: none;">
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <p style="margin: 0 0 10px 0; font-weight: 600; color: #495057;">Format CSV attendu :</p>
                        <code style="display: block; background: white; padding: 10px; border-radius: 4px; font-family: monospace; font-size: 0.85em;">
                            numero<br>
                            150<br>
                            152<br>
                            155<br>
                            ...
                        </code>
                        <p style="margin: 10px 0 0 0; font-size: 0.85em; color: #666;">
                            Le fichier doit contenir une colonne "numero" avec les num√©ros des candidats.
                        </p>
                    </div>

                    <div style="margin-bottom: 15px;">
                        <label class="btn btn-secondary" for="csvFileInput" style="cursor: pointer; display: inline-block; margin: 0;">
                            üìÅ Choisir un fichier CSV
                        </label>
                        <input type="file" id="csvFileInput" accept=".csv" style="display: none;" onchange="handleCsvImport(event)">
                        <span id="csvFileName" style="margin-left: 10px; color: #666; font-size: 0.9em;">Aucun fichier s√©lectionn√©</span>
                    </div>

                    <div id="csvPreview" class="candidates-preview" style="display: none;">
                        <!-- Aper√ßu des candidats import√©s -->
                    </div>
                </div>

                <div style="display: flex; justify-content: space-between; gap: 15px; margin-top: 20px;">
                    <button class="btn btn-secondary" onclick="goBackToBareme()">‚Üê Retour au bar√®me</button>
                    <button class="btn btn-primary" onclick="generateCandidates()">Continuer ‚Üí</button>
                </div>
            </div>
        </div>

        <!-- === PAGE DE GESTION DES CANDIDATS === -->
        <div class="candidates-page" id="candidatesPage">
            <div class="page-header">
                <div class="stats-row">
                    <div class="stat-card active">
                        <div class="stat-number" id="activeCount">21</div>
                        <div class="stat-label">Candidats actifs</div>
                    </div>
                    <div class="stat-card eliminated">
                        <div class="stat-number" id="eliminatedCount">0</div>
                        <div class="stat-label">Candidats √©limin√©s</div>
                    </div>
                    <div class="stat-card total">
                        <div class="stat-number" id="totalCount">21</div>
                        <div class="stat-label">Total g√©n√©r√©s</div>
                    </div>
                </div>

                <div class="validate-section">
                    <div class="validate-title">‚úì Valider votre paquet de copies</div>
                    <div class="validate-subtitle">Cliquez sur les candidats √† √©liminer (ceux qui ne font pas partie de votre paquet)</div>
                </div>

                <div class="candidates-grid" id="candidatesGrid">
                    <!-- Les candidats seront g√©n√©r√©s ici -->
                </div>

                <div class="info-box">
                    <strong>Comment √ßa marche :</strong> Cliquez sur une carte pour √©liminer/restaurer un candidat. 
                    Les candidats √©limin√©s sont barr√©s et en rouge. Seuls les candidats actifs (en bleu) seront trait√©s lors de la correction.
                </div>

                <div class="action-buttons">
                    <button class="btn btn-secondary" onclick="backToSetup()">‚Üê Recommencer</button>
                    <button class="btn btn-primary" onclick="startCorrection()" id="startCorrectionBtn">Commencer la correction (21 candidats) ‚Üí</button>
                </div>
            </div>
        </div>

        <!-- === PAGE VUE D'ENSEMBLE DES CANDIDATS === -->
        <div class="candidates-overview-page" id="candidatesOverviewPage">
            <div class="overview-header">
                <div class="overview-title">üìã Vue d'ensemble des candidats</div>
                <div class="overview-actions">
                    <div class="overview-actions-left">
                        <div class="correction-mode-selector not-selected" id="correctionModeSelector">
                            <span>üéØ Mode :</span>
                            <select id="correctionMode" onchange="updateCorrectionMode()">
                                <option value="">‚ö†Ô∏è Choisir un mode de correction</option>
                                <option value="candidate">üìã Par candidat (copie compl√®te)</option>
                                <option value="exercise">üéØ Par exercice (tous les candidats)</option>
                            </select>
                        </div>
                        <button class="export-btn" onclick="exportJSON()">
                            <span>‚¨á</span>
                            <span>Exporter JSON</span>
                        </button>
                        <button class="import-btn" onclick="importJSON()">
                            <span>‚¨Ü</span>
                            <span>Importer JSON</span>
                        </button>
                        <input type="file" id="importFileInput" accept=".json" style="display: none;" onchange="handleFileImport(event)">
                    </div>
                    <div class="motivation-checkbox">
                        <input type="checkbox" id="motivationAnimation" checked onchange="toggleMotivationAnimation()">
                        <label for="motivationAnimation">Animations de motivation (toutes les 5 copies)</label>
                    </div>
                </div>
            </div>

            <div class="mode-instruction show" id="modeInstruction">
                <strong>‚ö†Ô∏è Veuillez d'abord choisir votre mode de correction</strong><br>
                <span style="font-size: 12px; opacity: 0.8;">
                    üìã <strong>Par candidat</strong> : correction compl√®te candidat par candidat ‚Ä¢ 
                    üéØ <strong>Par exercice</strong> : correction exercice par exercice pour tous les candidats
                </span>
            </div>

            <div class="candidates-overview-grid" id="candidatesOverviewGrid">
                <!-- Les cartes candidats seront g√©n√©r√©es ici -->
            </div>

            <div class="overview-navigation">
                <button class="overview-nav-btn back" onclick="backToCandidatesFromOverview()">‚Üê Retour √† la s√©lection</button>
                <div id="correctionModeInfo" style="text-align: center; font-size: 13px; color: #6c757d;">
                    <!-- Info sur le mode de correction -->
                </div>
                <button class="overview-nav-btn start" onclick="startCorrectionFromOverview()">Commencer la correction individuelle ‚Üí</button>
            </div>
        </div>

        <!-- === PAGE PRINCIPALE === -->
        <div class="main-page" id="mainPage" style="display: none;">
            <div class="main-header">
                <div class="candidate-info">
                    <button class="back-btn" onclick="backToCandidates()">‚Üê Liste</button>
                    <div class="candidate-title" id="currentCandidateTitle">Correction du candidat n¬∞150</div>
                </div>

                <div class="score-info">
                    <div class="progress-info" id="progressInfo">Progression : 0%</div>
                    <div class="total-score" id="totalScoreDisplay">Score: 0 / 20 points</div>
                </div>
            </div>

            <div class="main-tabs" id="mainTabs">
                <!-- Onglets g√©n√©r√©s dynamiquement depuis exercisesData -->
            </div>



            <!-- === ONGLETS EXERCICES === -->
            <div id="exerciseTabsContainer">
                <!-- Contenus des exercices g√©n√©r√©s dynamiquement -->
            </div>

            <div class="navigation-buttons">
                <button class="nav-btn prev" onclick="navigatePrevious()" id="prevBtn">‚Üê Pr√©c√©dent</button>
                <button class="nav-btn validate" onclick="validateCorrection()" id="validateBtn" style="background: #28a745; color: white;">‚úì Valider la correction</button>
                <button class="nav-btn next" onclick="navigateNext()" id="nextBtn">Suivant ‚Üí</button>
            </div>
        </div>
    </div>

    <!-- === MODAL DE MODIFICATION CRIT√àRE === -->
    <div class="modal-overlay" id="competenceModal">
        <div class="modal-content">
            <div class="modal-header edit">
                Modifier un crit√®re de type "<span id="modalCompetenceType"></span>"
            </div>
            
            <div style="text-align: center; margin-bottom: 20px;">
                <div class="modal-competence-badge" style="border-radius: 20px; padding: 8px 16px; display: inline-block; color: white; transition: all 0.3s ease;">
                    <span id="modalCompetenceIcon" style="font-size: 18px; margin-right: 8px;">üßÆ</span>
                    <span id="modalCompetenceName" style="font-weight: bold;">Calculer 1</span>
                    <span style="margin-left: 8px; font-size: 12px; opacity: 0.9;">1 pt</span>
                </div>
            </div>
            
            <div class="modal-field">
                <label for="modalDescription">Description (obligatoire)</label>
                <textarea id="modalDescription" placeholder="Description qui appara√Ætra en info-bulle du haut..."></textarea>
            </div>
            
            <div class="modal-field">
                <label for="modalPoints">Nombre de points</label>
                <input type="number" id="modalPoints" min="0" max="20" step="0.5" value="1" oninput="updateModalPointsDisplay()">
            </div>
            
            <div class="modal-field">
                <label for="modalIncrement">Incr√©ment par clic</label>
                <input type="number" id="modalIncrement" min="0.5" max="5" step="0.5" value="1">
            </div>
            
            <div class="modal-field">
                <label for="modalTooltip">Info-bulle (facultatif)</label>
                <input type="text" id="modalTooltip" placeholder="Information suppl√©mentaire qui appara√Ætra en bas...">
            </div>
            
            <div class="modal-buttons">
                <button class="modal-btn cancel" onclick="closeCompetenceModal()">Annuler</button>
                <button class="modal-btn save" onclick="saveCompetenceModal()">Mettre √† jour le crit√®re</button>
            </div>
        </div>
    </div>

    <!-- === MODAL DE S√âLECTION COMP√âTENCES === -->
    <div class="modal-overlay" id="competenceSelectionModal">
        <div class="modal-content">
            <div class="modal-header select">
                Choisir un type de crit√®re
            </div>
            
            <div class="competences-selection-grid">
                <div class="competence-selection-btn" onclick="selectCompetence('Calculer')">
                    <div class="icon">üßÆ</div>
                    <div class="name">Calculer</div>
                </div>
                
                <div class="competence-selection-btn" onclick="selectCompetence('Mod√©liser')">
                    <div class="icon">üìä</div>
                    <div class="name">Mod√©liser</div>
                </div>
                
                <div class="competence-selection-btn" onclick="selectCompetence('Repr√©senter')">
                    <div class="icon">üìà</div>
                    <div class="name">Repr√©senter</div>
                </div>
                
                <div class="competence-selection-btn" onclick="selectCompetence('Raisonner')">
                    <div class="icon">ü§î</div>
                    <div class="name">Raisonner</div>
                </div>
                
                <div class="competence-selection-btn" onclick="selectCompetence('Communiquer')">
                    <div class="icon">‚úì</div>
                    <div class="name">Communiquer</div>
                </div>
                
                <div class="competence-selection-btn" onclick="selectCompetence('Chercher')">
                    <div class="icon">üîç</div>
                    <div class="name">Chercher</div>
                </div>
                
                <div class="competence-selection-btn create-new-btn" onclick="createNewCompetenceType()">
                    <div class="icon">‚ûï</div>
                    <div class="name">Cr√©er un nouveau type</div>
                </div>
            </div>
            
            <div class="modal-buttons">
                <button class="modal-btn cancel" onclick="closeCompetenceSelectionModal()">Annuler</button>
            </div>
        </div>
    </div>

    <!-- === MODALE DE COMMENTAIRE === -->
    <div class="modal-overlay" id="commentModal">
        <div class="modal-content">
            <div class="modal-header">
                üí¨ Commentaire pour le candidat n¬∞<span id="commentCandidateNumber">150</span>
            </div>
            
            <div style="text-align: center; margin-bottom: 20px;">
                <div style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 15px;">
                    <div style="margin-bottom: 10px;">
                        <strong>Note : <span id="commentScore">17</span>/20</strong>
                    </div>
                    <div style="font-size: 0.9em; color: #6c757d;">
                        <span id="commentProgress">20/20 questions trait√©es</span>
                        <span id="commentNR" style="color: #dc3545; margin-left: 10px;"></span>
                    </div>
                </div>
            </div>
            
            <div class="modal-field">
                <label for="candidateComment">Commentaire personnalis√©</label>
                <textarea id="candidateComment" placeholder="Ajouter un commentaire pour ce candidat..." rows="4"></textarea>
            </div>
            
            <div class="modal-buttons">
                <button class="modal-btn cancel" onclick="closeCommentModal()">Annuler</button>
                <button class="modal-btn save" onclick="saveComment()">Enregistrer le commentaire</button>
            </div>
        </div>
    </div>

    <!-- === MODALE DE SYNTH√àSE DES COMP√âTENCES === -->
    <div class="modal-overlay" id="competencesSynthesisModal">
        <div class="modal-content synthesis-modal">
            <div class="modal-header synthesis-header">
                üìä Synth√®se des comp√©tences - Candidat n¬∞<span id="synthesisCandidateNumber">150</span>
            </div>
            
            <div class="synthesis-score-section">
                <div class="synthesis-main-score" id="synthesisMainScore">17/20</div>
                <div class="synthesis-details">
                    <span id="synthesisProgress">29/29 questions trait√©es</span>
                    <span id="synthesisNR"></span>
                </div>
            </div>
            
            <div class="competences-synthesis-grid" id="competencesSynthesisGrid">
                <!-- Les comp√©tences seront g√©n√©r√©es ici -->
            </div>
            
            <div class="modal-field">
                <label for="synthesisComment">Commentaire global</label>
                <textarea id="synthesisComment" placeholder="Saisissez un commentaire global sur la copie..." rows="4"></textarea>
            </div>
            
            <div class="modal-buttons">
                <button class="modal-btn cancel" onclick="closeSynthesisModal()">Annuler</button>
                <button class="modal-btn save" onclick="confirmSynthesisValidation()">‚úÖ Valider la correction et revenir √† la liste</button>
            </div>
        </div>
    </div>

    <!-- === PANNEAU DES PARAM√àTRES === -->
    <div class="admin-panel" id="parametresPanel" style="display: none;">
        <div class="admin-panel-container">
            <div class="admin-panel-header">
                <div class="admin-panel-title">
                    <span class="admin-icon">üéõÔ∏è</span>
                    <span>Param√®tres du bar√®me</span>
                </div>
                <button class="admin-close-btn" onclick="toggleParametresPanel()">√ó</button>
            </div>
            
            <div class="admin-section">
                <div class="admin-section-title">üéØ Mode de d√©finition du bar√®me</div>
                
                <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                    <p style="margin-bottom: 15px; color: #1565c0; font-weight: 600;">
                        Choisissez comment vous souhaitez attribuer les points aux comp√©tences :
                    </p>
                    
                    <div style="display: flex; flex-direction: column; gap: 12px;">
                        <!-- Mode A -->
                        <label style="display: flex; align-items: start; gap: 12px; padding: 15px; background: white; border-radius: 8px; border: 2px solid #dee2e6; cursor: pointer; transition: all 0.2s;"
                               onmouseover="this.style.borderColor='#4285f4'" 
                               onmouseout="this.style.borderColor=appState.baremeConfig.mode==='a'?'#4285f4':'#dee2e6'">
                            <input type="radio" 
                                   name="baremeMode" 
                                   value="a" 
                                   onchange="changeBaremeMode('a')"
                                   ${appState.baremeConfig.mode === 'a' ? 'checked' : ''}
                                   style="margin-top: 3px;">
                            <div style="flex: 1;">
                                <div style="font-weight: bold; color: #2c3e50; margin-bottom: 5px;">
                                    üìä Mode A : Points par comp√©tence
                                </div>
                                <div style="font-size: 0.9em; color: #666;">
                                    Vous d√©finissez le nombre de points pour chaque comp√©tence individuellement
                                </div>
                            </div>
                        </label>
                        
                        <!-- Mode B (d√©faut) -->
                        <label style="display: flex; align-items: start; gap: 12px; padding: 15px; background: white; border-radius: 8px; border: 2px solid #4285f4; cursor: pointer; transition: all 0.2s;"
                               onmouseover="this.style.borderColor='#4285f4'" 
                               onmouseout="this.style.borderColor=appState.baremeConfig.mode==='b'?'#4285f4':'#dee2e6'">
                            <input type="radio" 
                                   name="baremeMode" 
                                   value="b" 
                                   onchange="changeBaremeMode('b')"
                                   checked
                                   style="margin-top: 3px;">
                            <div style="flex: 1;">
                                <div style="font-weight: bold; color: #2c3e50; margin-bottom: 5px;">
                                    ‚ö° Mode B : R√©partition automatique (RECOMMAND√â)
                                </div>
                                <div style="font-size: 0.9em; color: #666;">
                                    D√©finissez le total de points, les points sont r√©partis √©quitablement entre les comp√©tences
                                </div>
                            </div>
                        </label>
                        
                        <!-- Mode C -->
                        <label style="display: flex; align-items: start; gap: 12px; padding: 15px; background: white; border-radius: 8px; border: 2px solid #dee2e6; cursor: pointer; transition: all 0.2s;"
                               onmouseover="this.style.borderColor='#4285f4'" 
                               onmouseout="this.style.borderColor=appState.baremeConfig.mode==='c'?'#4285f4':'#dee2e6'">
                            <input type="radio" 
                                   name="baremeMode" 
                                   value="c" 
                                   onchange="changeBaremeMode('c')"
                                   ${appState.baremeConfig.mode === 'c' ? 'checked' : ''}
                                   style="margin-top: 3px;">
                            <div style="flex: 1;">
                                <div style="font-weight: bold; color: #2c3e50; margin-bottom: 5px;">
                                    üéØ Mode C : Total uniquement
                                </div>
                                <div style="font-size: 0.9em; color: #666;">
                                    Seul le total de points compte, sans d√©tail par comp√©tence
                                </div>
                            </div>
                        </label>
                    </div>
                </div>
                
                <div style="background: #fff3cd; padding: 12px; border-radius: 6px; border-left: 4px solid #ffc107; margin-top: 15px;">
                    <strong>üí° Astuce :</strong> Le mode B (r√©partition automatique) est le plus rapide pour commencer. Vous pourrez toujours basculer vers le mode A si vous souhaitez plus de pr√©cision.
                </div>
            </div>
        </div>
    </div>

    <!-- === PANNEAU D'ADMINISTRATION GLOBAL === -->
    <div class="admin-panel" id="adminPanel" style="display: none;">
        <div class="admin-panel-container">
            <div class="admin-panel-header">
                <div class="admin-panel-title">
                    <span class="admin-icon">‚öôÔ∏è</span>
                    <span>Panneau d'administration</span>
                </div>
                <button class="admin-close-btn" onclick="toggleAdminPanel()">√ó</button>
            </div>
            
            <div class="admin-tabs">
                <button class="admin-tab active" onclick="showAdminTab('bareme')">
                    <span class="admin-tab-icon">üìù</span>
                    <span>Bar√®me</span>
                </button>
                <button class="admin-tab" onclick="showAdminTab('test')">
                    <span class="admin-tab-icon">üß™</span>
                    <span>Outils de test</span>
                </button>
            </div>

            <!-- Sous-onglet Bar√®me -->
            <div class="admin-tab-content active" id="adminBaremeTab">
                <div class="admin-section">
                    <div class="admin-section-title">üìù Configuration du bar√®me et des comp√©tences</div>
                    
                    <div style="background: #fff3cd; padding: 12px; border-radius: 6px; margin-bottom: 15px; border-left: 4px solid #ffc107;">
                        <strong>‚ö†Ô∏è Attention :</strong> Les modifications du bar√®me s'appliquent √† tous les candidats. 
                        Sauvegardez vos changements avant de commencer la correction.
                    </div>
                    
                    <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #2196f3;">
                        <strong>üìã Workflow recommand√© :</strong>
                        <ol style="margin: 10px 0 0 20px; line-height: 1.6;">
                            <li><strong>Modification :</strong> Ajustez les crit√®res et points via cette interface</li>
                            <li><strong>Sauvegarde temporaire :</strong> Cliquez "üíæ Sauvegarder en m√©moire"</li>
                            <li><strong>Export de test :</strong> Cliquez "üì§ Exporter le bar√®me (JSON)" pour conserver vos tests</li>
                            <li><strong>Test en correction :</strong> Utilisez le bar√®me pour quelques copies</li>
                            <li><strong>Ajustements :</strong> Modifiez et r√©-exportez si n√©cessaire</li>
                            <li><strong>Finalisation :</strong> Une fois s√ªr, demandez la g√©n√©ration d'un HTML d√©finitif</li>
                        </ol>
                    </div>

                    <!-- Navigation par exercice pour le bar√®me -->
                    <div class="admin-exercise-tabs">
                        <button class="admin-exercise-tab active" onclick="showAdminExercise(1)">
                            <span>üé≤</span> Exercice 1
                        </button>
                        <button class="admin-exercise-tab" onclick="showAdminExercise(2)">
                            <span>üìê</span> Exercice 2
                        </button>
                        <button class="admin-exercise-tab" onclick="showAdminExercise(3)">
                            <span>‚òê</span> Exercice 3
                        </button>
                        <button class="admin-exercise-tab" onclick="showAdminExercise(4)">
                            <span>üíª</span> Exercice 4
                        </button>
                        <button class="admin-exercise-tab" onclick="showAdminExercise(5)">
                            <span>üìà</span> Exercice 5
                        </button>
                    </div>

                    <div class="admin-exercise-content" id="adminExerciseContent">
                        <!-- Le contenu de l'exercice s√©lectionn√© sera g√©n√©r√© ici -->
                    </div>

                    <div class="bareme-actions">
                        <button class="save-bareme-btn" onclick="saveBareme()">
                            üíæ Sauvegarder en m√©moire
                        </button>
                        
                        <div class="bareme-import-export">
                            <button class="export-bareme-btn" onclick="exportBareme()">
                                üì§ Exporter le bar√®me (JSON)
                            </button>
                            <button class="import-bareme-btn" onclick="importBareme()">
                                üì• Importer un bar√®me (JSON)
                            </button>
                            <input type="file" id="importBaremeInput" accept=".json" style="display: none;" onchange="handleBaremeImport(event)">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sous-onglet Outils de test -->
            <div class="admin-tab-content" id="adminTestTab">
                <div class="admin-section">
                    <div class="admin-section-title">üß™ Outils de test d√©veloppeur</div>
                    
                    <div style="background: #fff3cd; padding: 12px; border-radius: 6px; margin-bottom: 15px; border-left: 4px solid #ffc107;">
                        <strong>‚ÑπÔ∏è Mode test :</strong> Ces outils permettent de tester les animations et fonctionnalit√©s sans corriger toutes les copies.
                    </div>

                    <div class="test-buttons-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 8px; margin-bottom: 15px;">
                        <button class="test-btn" onclick="generateTestCandidates()" style="background: #17a2b8; color: white; padding: 8px 12px; border: none; border-radius: 6px; cursor: pointer;">
                            üë• G√©n√©rer 5 candidats test
                        </button>
                        <button class="test-btn" onclick="quickFillAllCandidates()" style="background: #28a745; color: white; padding: 8px 12px; border: none; border-radius: 6px; cursor: pointer;">
                            ‚ö° Pr√©-remplir tous les candidats
                        </button>
                        <button class="test-btn" onclick="testAnimation(5)" style="background: #ffc107; color: black; padding: 8px 12px; border: none; border-radius: 6px; cursor: pointer;">
                            üéâ Test 5 copies (d√©but)
                        </button>
                        <button class="test-btn" onclick="testAnimation(15)" style="background: #fd7e14; color: white; padding: 8px 12px; border: none; border-radius: 6px; cursor: pointer;">
                            ‚≠ê Test 15 copies (ma√Ætrise)
                        </button>
                        <button class="test-btn" onclick="testAnimation(25)" style="background: #6f42c1; color: white; padding: 8px 12px; border: none; border-radius: 6px; cursor: pointer;">
                            üíé Test 25 copies (endurance)
                        </button>
                        <button class="test-btn" onclick="testAnimation(40)" style="background: #28a745; color: white; padding: 8px 12px; border: none; border-radius: 6px; cursor: pointer;">
                            üî• Test 40 copies (performance)
                        </button>
                        <button class="test-btn" onclick="testCompletionModal()" style="background: #dc3545; color: white; padding: 8px 12px; border: none; border-radius: 6px; cursor: pointer;">
                            üèÅ Tester fin de correction
                        </button>
                    </div>

                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                        <label for="testCounter" style="font-weight: bold;">Compteur copies valid√©es :</label>
                        <input type="number" id="testCounter" min="0" max="100" value="0" style="width: 80px; padding: 4px 8px; border: 1px solid #ccc; border-radius: 4px;">
                        <button onclick="updateTestCounter()" style="background: #6c757d; color: white; padding: 4px 12px; border: none; border-radius: 4px; cursor: pointer;">
                            Appliquer
                        </button>
                    </div>

                    <button class="test-btn" onclick="resetAllData()" style="background: #dc3545; color: white; padding: 8px 12px; border: none; border-radius: 6px; cursor: pointer; width: 100%;">
                        üóëÔ∏è R√©initialiser toutes les donn√©es
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- === MODAL D'ANIMATION DE MOTIVATION === -->
    <div class="modal-overlay" id="motivationModal" style="background: rgba(0,0,0,0.8); z-index: 15000;">
        <div class="motivation-content">
            <div class="confetti-container" id="confettiContainer"></div>
            <div class="motivation-message">
                <div class="motivation-icon" id="motivationIcon">üéâ</div>
                <div class="motivation-title" id="motivationTitle">Bravo !</div>
                <div class="motivation-text" id="motivationText">5 copies corrig√©es ! Vous √™tes sur la bonne voie !</div>
                <div class="motivation-continue">Continuez ainsi ! üí™</div>
            </div>
        </div>
    </div>

    <!-- === MODAL DE FIN DE CORRECTION === -->
    <div class="modal-overlay" id="completionModal">
        <div class="modal-content completion-modal">
            <div class="completion-header">
                üèÅ Correction termin√©e !
            </div>
            
            <div class="completion-message">
                <div class="completion-congrats">
                    üéâ <strong>F√©licitations !</strong> Toutes les copies ont √©t√© corrig√©es !
                </div>
                
                <div class="completion-thanks">
                    Merci d'avoir utilis√© cet outil de correction DNB.
                </div>
                
                <div class="completion-request">
                    <p><strong>Pour encourager le d√©veloppement et am√©liorer l'outil gr√¢ce aux statistiques de correction :</strong></p>
                    <p>Merci d'exporter le fichier JSON et de l'envoyer √† : <strong>correction-dnb@ac-nantes.fr</strong></p>
                    <p style="font-size: 0.9em; color: #6c757d;">Votre contribution aide √† am√©liorer l'outil pour tous les correcteurs !</p>
                </div>
                
                <div class="completion-actions">
                    <button class="btn-export-final" onclick="exportFinalData()">
                        üì§ Exporter mes donn√©es de correction
                    </button>
                </div>
            </div>
            
            <div class="completion-survey" id="completionSurvey" style="display: none;">
                <div class="survey-title">üìã √âvaluation rapide (optionnel)</div>
                <div class="survey-questions" id="surveyQuestions">
                    <!-- Questions g√©n√©r√©es dynamiquement -->
                </div>
                <div class="survey-actions">
                    <button class="btn-skip-survey" onclick="skipSurvey()">Passer</button>
                    <button class="btn-submit-survey" onclick="submitSurvey()">Envoyer l'√©valuation</button>
                </div>
            </div>
            
            <div class="modal-buttons">
                <button class="modal-btn cancel" onclick="closeCompletionModal()">Fermer</button>
                <button class="modal-btn save" onclick="showSurvey()" id="btnShowSurvey">üìã √âvaluer l'outil (optionnel)</button>
            </div>
        </div>
    </div>

    <!-- === MODALE DE VALIDATION AVEC SYNTH√àSE INT√âGR√âE === -->
    <div class="modal-overlay" id="validationModal">
        <div class="modal-content validation-synthesis-modal">
            <div class="validation-header">
                <span class="validation-title">Candidat n¬∞<span id="validationCandidateNumber">150</span></span>
                <button class="close-btn" onclick="closeValidationModal()">√ó</button>
            </div>
            
            <div class="exercises-badges-container" id="exercisesValidationGrid">
                <!-- Les badges d'exercices seront g√©n√©r√©s ici -->
            </div>
            
            <div class="main-score-container">
                <div class="main-score-badge" id="validationMainScore">17/20</div>
                <div class="score-nr" id="validationNR"></div>
            </div>
            
            <div class="competences-table-container">
                <table class="competences-table">
                    <thead>
                        <tr>
                            <th>Comp√©tence</th>
                            <th>% & Items</th>
                            <th>Niveau</th>
                            <th>Progression</th>
                        </tr>
                    </thead>
                    <tbody id="competencesValidationTable">
                        <!-- Les comp√©tences seront g√©n√©r√©es ici -->
                    </tbody>
                </table>
            </div>
            
            <div class="comment-section">
                <div class="comment-header">
                    <label for="validationComment">Commentaire global</label>
                    <button type="button" class="voice-btn" id="voiceBtn" onclick="toggleVoiceRecognition()">
                        üé§ Dict√©e vocale
                    </button>
                </div>
                <textarea id="validationComment" placeholder="Saisissez un commentaire global sur la copie..." rows="4"></textarea>
                <div class="voice-status" id="voiceStatus" style="display: none;">
                    <span class="voice-indicator">üî¥ √âcoute en cours...</span>
                </div>
            </div>
            
            <div class="modal-actions">
                <button class="btn-cancel" onclick="closeValidationModal()">Annuler</button>
                <button class="btn-validate-next" onclick="confirmValidationAndNext()" id="btnValidateNext">‚û°Ô∏è Valider et candidat suivant</button>
                <button class="btn-validate" onclick="confirmValidationAndReturn()">‚úÖ Valider et revenir √† la liste</button>
            </div>
        </div>
    </div>

    <!-- Modale d'√©dition de comp√©tence pour le bar√®me -->
    <div id="baremeCompetenceModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); backdrop-filter: blur(4px); z-index: 10000; align-items: center; justify-content: center;">
        <div style="background: white; border-radius: 16px; max-width: 500px; width: 90%; max-height: 90vh; overflow-y: auto; box-shadow: 0 20px 60px rgba(0,0,0,0.3); animation: modalSlideIn 0.3s ease;">
            <div id="baremeCompModalHeader" style="background: #28a745; color: white; padding: 20px; border-radius: 16px 16px 0 0; display: flex; justify-content: space-between; align-items: center;">
                <div style="display: flex; align-items: center; gap: 12px;">
                    <span id="baremeCompModalIcon" style="font-size: 28px;">‚úèÔ∏è</span>
                    <div>
                        <h3 id="baremeCompModalTitle" style="margin: 0; font-size: 1.3em;">√âditer la comp√©tence</h3>
                        <p id="baremeCompModalSubtitle" style="margin: 4px 0 0 0; opacity: 0.9; font-size: 0.9em;">Calculer</p>
                    </div>
                </div>
                <button onclick="closeBaremeCompetenceModal()" style="background: rgba(255,255,255,0.2); border: none; color: white; font-size: 24px; cursor: pointer; border-radius: 50%; width: 36px; height: 36px; display: flex; align-items: center; justify-content: center; transition: all 0.2s;">√ó</button>
            </div>

            <div style="padding: 24px;">
                <div style="margin-bottom: 20px;">
                    <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #2c3e50;">
                        üìù Description <span style="color: #dc3545;">*</span>
                    </label>
                    <p style="font-size: 0.85em; color: #666; margin: 0 0 8px 0;">
                        D√©crivez bri√®vement ce qui sera √©valu√© (appara√Æt sur le bouton de correction)
                    </p>
                    <textarea id="baremeCompDescription"
                              placeholder="Ex: Effectuer le calcul de probabilit√©"
                              style="width: 100%; padding: 10px; border: 2px solid #dee2e6; border-radius: 8px; font-family: inherit; min-height: 70px; resize: vertical;"
                              required></textarea>
                    <div id="descriptionError" style="color: #dc3545; font-size: 0.85em; margin-top: 4px; display: none;">
                        ‚ö†Ô∏è La description est obligatoire
                    </div>
                </div>

                <div style="margin-bottom: 20px;">
                    <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #2c3e50;">
                        üí° Tooltip (optionnel)
                    </label>
                    <p style="font-size: 0.85em; color: #666; margin: 0 0 8px 0;">
                        Informations suppl√©mentaires (s'affiche au survol du bouton)
                    </p>
                    <textarea id="baremeCompTooltip"
                              placeholder="Ex: Utiliser la formule P = n/N"
                              style="width: 100%; padding: 10px; border: 2px solid #dee2e6; border-radius: 8px; font-family: inherit; min-height: 60px; resize: vertical;"></textarea>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                    <div>
                        <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #2c3e50;">
                            üéØ Points max
                        </label>
                        <input type="number"
                               id="baremeCompPoints"
                               value="2"
                               min="0.5"
                               max="20"
                               step="0.5"
                               style="width: 100%; padding: 10px; border: 2px solid #dee2e6; border-radius: 8px; font-size: 1em;">
                    </div>
                    <div>
                        <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #2c3e50;">
                            ‚ûï Incr√©ment
                        </label>
                        <input type="number"
                               id="baremeCompIncrement"
                               value="1"
                               min="0.5"
                               max="5"
                               step="0.5"
                               style="width: 100%; padding: 10px; border: 2px solid #dee2e6; border-radius: 8px; font-size: 1em;">
                    </div>
                </div>

                <div style="display: flex; gap: 10px;">
                    <button onclick="saveBaremeCompetenceModal()"
                            style="flex: 1; padding: 12px 24px; background: #28a745; color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; font-size: 1em; transition: all 0.2s;"
                            onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(40, 167, 69, 0.4)';"
                            onmouseout="this.style.transform=''; this.style.boxShadow='';">
                        ‚úÖ Sauvegarder
                    </button>
                    <button onclick="closeBaremeCompetenceModal()"
                            style="padding: 12px 24px; background: #6c757d; color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.2s;"
                            onmouseover="this.style.background='#5a6268';"
                            onmouseout="this.style.background='#6c757d';">
                        Annuler
                    </button>
                </div>
            </div>
        </div>
    </div>
    </div><!-- Fin contentWrapper -->

    <script src="js/state/appState.js?v=20251105017"></script>
    <script src="js/workflow.js?v=20251105017"></script>
    <!-- Mode test JSON (optionnel) -->
    <script src="js/modules/importJSON.js?v=20251105017"></script>
    <script src="js/app.js?v=20251105017"></script>
</body>
</html>
{"version":3,"file":"6I1B-4-Cc5rEPlq.js","sources":["../../src/lib/tableur/MySpreadSheet.ts","../../src/exercices/6e/6I1B-4.ts"],"sourcesContent":["import jspreadsheet from 'jspreadsheet-ce'\nimport 'jspreadsheet-ce/dist/jspreadsheet.css'\n\nexport class MySpreadsheetElement extends HTMLElement {\n  private _spreadsheet: any = null\n  private _buttonListener?: EventListener\n  private _customListeners: { [eventName: string]: EventListener } = {}\n\n  constructor() {\n    super()\n    this._spreadsheet = null\n  }\n\n  /**\n   * Ajoute un listener sur l'√©l√©ment et le m√©morise pour suppression ult√©rieure\n   */\n  public addListener(eventName: string, callback: EventListener) {\n    this.addEventListener(eventName, callback)\n    this._customListeners[eventName] = callback\n  }\n\n  /**\n   * M√©thode statique pour cr√©er et configurer un MySpreadsheetElement\n   */\n  static create({\n    id,\n    data = [],\n    minDimensions = [5, 5],\n    style = {},\n    columns = [],\n    interactif = false,\n  }: {\n    id?: string\n    data?: (string | number)[][]\n    minDimensions?: [number, number]\n    style?: any\n    columns?: any[]\n    interactif?: boolean\n  } = {}) {\n    const elt = new MySpreadsheetElement()\n    if (id) elt.id = id\n    elt.setAttribute('data', JSON.stringify(data))\n    elt.setAttribute('min-dimensions', JSON.stringify(minDimensions))\n    elt.setAttribute('style', JSON.stringify(style))\n    elt.setAttribute('columns', JSON.stringify(columns))\n    elt.setAttribute('interactif', interactif ? 'true' : 'false')\n    return elt\n  }\n\n  connectedCallback() {\n    this.innerHTML = '<div></div>'\n    const container = (this.firstElementChild ??\n      document.createElement('div')) as HTMLDivElement\n\n    let data: (number | string)[][] = []\n    let minDimensions = [5, 5]\n    let style = {}\n    let columns = []\n    try {\n      if (this.getAttribute('data'))\n        data = JSON.parse(this.getAttribute('data') ?? '') as (\n          | string\n          | number\n        )[][]\n    } catch {}\n    try {\n      if (this.getAttribute('min-dimensions'))\n        minDimensions = JSON.parse(this.getAttribute('min-dimensions') ?? '')\n    } catch {}\n    try {\n      if (this.getAttribute('style'))\n        style = JSON.parse(this.getAttribute('style') ?? '')\n    } catch {}\n    try {\n      if (this.getAttribute('columns'))\n        columns = JSON.parse(this.getAttribute('columns') ?? '[]')\n    } catch {}\n    this._spreadsheet = jspreadsheet(container, {\n      tabs: false,\n      toolbar: false,\n      worksheets: [\n        {\n          data,\n          minDimensions,\n          tableOverflow: true,\n          tableHeight: '300px',\n          style,\n          columns,\n        } as any,\n      ],\n    })[0]\n    let numeroExercice = 0\n    let question = 0\n    const idMatch = this.id.match(/sheet-Ex(\\d+)Q(\\d+)$/)\n    if (idMatch) {\n      numeroExercice = Number(idMatch[1])\n      question = Number(idMatch[2])\n    }\n\n    const feedBackElt = document.createElement('div')\n    feedBackElt.id = 'message-faux'\n    container.appendChild(feedBackElt)\n    const resultCheck = document.createElement('span')\n    resultCheck.id = `resultatCheckEx${numeroExercice}Q${question}`\n    container.appendChild(resultCheck)\n    const divFeedback = document.createElement('div')\n    divFeedback.id = `feedbackEx${numeroExercice}Q${question}`\n    divFeedback.className =\n      'italic text-coopmaths-warn-darkest dark:text-coopmathsdark-warn-darkest'\n    container.appendChild(divFeedback)\n    const bouton = document.createElement('button')\n    bouton.id = 'runCode'\n    bouton.textContent = 'V√©rifier'\n    bouton.style.boxSizing = 'border-box'\n    bouton.style.position = 'relative'\n    bouton.style.zIndex = '10'\n    bouton.style.marginTop = '10px'\n    // Styles personnalis√©s\n    bouton.style.backgroundColor = '#2b6cb0' // Bleu coopmaths\n    bouton.style.color = 'white' // Texte blanc\n    bouton.style.border = 'none' // Pas de bordure\n    bouton.style.borderRadius = '6px' // Bords arrondis\n    bouton.style.padding = '8px 20px' // Espacement interne\n    bouton.style.fontSize = '1rem' // Taille du texte\n    bouton.style.fontWeight = 'bold' // Texte en gras\n    bouton.style.cursor = 'pointer' // Curseur main au survol\n    bouton.style.boxShadow = '0 2px 6px rgba(0,0,0,0.08)' // Ombre l√©g√®re\n\n    // Effet au survol\n    bouton.onmouseover = () => {\n      bouton.style.backgroundColor = '#174ea6'\n    }\n    bouton.onmouseout = () => {\n      bouton.style.backgroundColor = '#2b6cb0'\n    }\n    bouton.style.display =\n      this.getAttribute('interactif') === 'true' ? 'none' : 'block'\n    container.appendChild(bouton)\n    if (idMatch) {\n      const numeroExercice = Number(idMatch[1])\n      const question = Number(idMatch[2])\n      this._setupButton(bouton, numeroExercice, question)\n    }\n    this.dispatchEvent(new CustomEvent('spreadsheet-ready'))\n  }\n\n  disconnectedCallback() {\n    if (this._spreadsheet) {\n      this._spreadsheet = null\n    }\n    // Retire le listener personnalis√©\n    const bouton = this.querySelector('#runCode')\n    if (bouton && this._buttonListener) {\n      bouton.removeEventListener('click', this._buttonListener)\n    }\n    // Retire tous les listeners ajout√©s via addListener\n    Object.entries(this._customListeners).forEach(([eventName, callback]) => {\n      this.removeEventListener(eventName, callback)\n    })\n    this._customListeners = {}\n  }\n\n  _setupButton(\n    bouton: HTMLButtonElement,\n    numeroExercice: number,\n    question: number,\n  ) {\n    const eventName = `checkEx${numeroExercice}Q${question}`\n    this._buttonListener = () => {\n      this.dispatchEvent(\n        new CustomEvent(eventName, { detail: { sheet: this } }),\n      )\n    }\n    bouton.addEventListener('click', this._buttonListener)\n  }\n\n  getCellValue(column: number, row: number) {\n    return this._spreadsheet.getValueFromCoords(column, row, true)\n  }\n\n  getCellFormula(column: number, row: number) {\n    return this._spreadsheet.getValueFromCoords(column, row, false)\n  }\n\n  getData() {\n    // Retourne les donn√©es de la premi√®re worksheet\n    return this._spreadsheet.getData() ?? []\n  }\n\n  setCellValue(column: number, row: number, value: string | number) {\n    this._spreadsheet.setValueFromCoords(column, row, value, true)\n  }\n\n  setCellFormula(column: number, row: number, formula: string) {\n    if (!formula.startsWith('=')) formula = '=' + formula\n    this._spreadsheet.setValueFromCoords(column, row, formula, true)\n  }\n\n  setData(data: any[]) {\n    this._spreadsheet.setData(data)\n  }\n\n  isMounted() {\n    return this._spreadsheet !== null\n  }\n\n  getMinDimensions() {\n    return this._spreadsheet.minDimensions ?? [5, 5]\n  }\n\n  getStyle() {\n    return this._spreadsheet.style ?? {}\n  }\n\n  getColumns() {\n    return this._spreadsheet.columns ?? []\n  }\n}\n\ncustomElements.define('my-spreadsheet', MySpreadsheetElement)\n\nexport function addSheet({\n  numeroExercice,\n  question,\n  data,\n  minDimensions,\n  style,\n  columns,\n  interactif,\n}: {\n  numeroExercice: number\n  question: number\n  data: any[][]\n  minDimensions: [number, number]\n  style: any\n  columns: any[]\n  interactif: boolean\n}): string {\n  return (\n    `<my-spreadsheet\n  id=\"sheet-Ex${numeroExercice}Q${question}\"\n  data='${JSON.stringify(data)}'\n  min-dimensions='${JSON.stringify(minDimensions)}'\n  style='${JSON.stringify(style)}'\n  columns='${JSON.stringify(columns)}'\n  interactif='${interactif}'\n>` +\n    (interactif\n      ? `<div class=\"ml-2 py-2\" id=\"resultatCheckEx${numeroExercice}Q${question}\"></div>\n<div class =\"ml-2 py-2 italic text-coopmaths-warn-darkest dark:text-coopmathsdark-warn-darkest\" id=\"feedbackEx${numeroExercice}Q${question}\"}></div>`\n      : '') +\n    '</my-spreadsheet>'\n  )\n}\n","import { point } from '../../lib/2d/points'\nimport { polygone } from '../../lib/2d/polygones'\nimport { segment } from '../../lib/2d/segmentsVecteurs'\nimport { latex2d } from '../../lib/2d/textes'\nimport { choice, shuffle } from '../../lib/outils/arrayOutils'\nimport { listeDesDiviseurs } from '../../lib/outils/primalite'\nimport { texNombre } from '../../lib/outils/texNombre'\nimport { addSheet, MySpreadsheetElement } from '../../lib/tableur/MySpreadSheet'\nimport { colorToLatexOrHTML, mathalea2d } from '../../modules/2dGeneralites'\nimport { context } from '../../modules/context'\n\nimport {\n  gestionnaireFormulaireTexte,\n  listeQuestionsToContenu,\n  randint,\n} from '../../modules/outils'\nimport Exercice from '../Exercice'\n\nexport const titre = 'Programmer des calculs sur tableur'\nexport const dateDePublication = '12/08/2025'\n\nexport const interactifReady = true\nexport const interactifType = 'custom'\n\n/*\n * Programmer des calculs sur tableur : New programme de 6eme 2025\n * @author Mickael Guironnet\n * revisit√© par Jean-Claude Lhote (intoduction du custom √©l√©ment sheet-element) et modification de la librairie utilis√©e.\n */\n\nexport const uuid = 'ae07c'\n\nexport const refs = {\n  'fr-fr': ['6I1B-4'],\n  'fr-ch': [],\n}\nconst alphabet = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'\n\nexport default class ExerciceTableur extends Exercice {\n  destroyers: (() => void)[] = []\n  listeSteps: Steps[] = []\n\n  constructor() {\n    super()\n    this.nbQuestions = 2\n    this.besoinFormulaireNumerique = [\n      \"Nombre d'op√©rations (entre 2 et 5 ou bien 1 si vous laissez le hasard d√©cider)\",\n      5,\n    ]\n    this.besoinFormulaire2Texte = [\n      \"Type d'op√©rations\",\n      [\n        'Nombres s√©par√©s par des tirets  :',\n        '1 : Addition',\n        '2 : Soustraction',\n        '3 : Multiplication',\n        '4 : Division',\n        '5 : M√©lange',\n      ].join('\\n'),\n    ]\n    this.sup = 3\n    this.sup2 = 5\n    this.listeSteps = []\n  }\n\n  destroy() {\n    // MGu quan l'exercice est supprim√© par svelte : bouton supprim√©\n    this.destroyers.forEach((destroy) => destroy())\n    this.destroyers.length = 0\n  }\n\n  static readonly colors = {\n    orange: '#e6b457',\n    vert: '#7adb7a',\n    jaune: '#e6e66a',\n    bleu: '#8181e6',\n    violet: '#f8a3f8',\n    rouge: '#eca2a2',\n  }\n\n  static readonly styles = {\n    style_id_rouge: {\n      fs: 12,\n      bg: ExerciceTableur.colors.rouge,\n    },\n    style_id_bleu: {\n      fs: 12,\n      bg: ExerciceTableur.colors.bleu,\n    },\n    style_id_orange: {\n      fs: 12,\n      bg: ExerciceTableur.colors.orange,\n    },\n    style_id_violet: {\n      fs: 12,\n      bg: ExerciceTableur.colors.violet,\n    },\n    style_id_vert: {\n      fs: 12,\n      bg: ExerciceTableur.colors.vert,\n    },\n    style_id_jaune: {\n      fs: 12,\n      bg: ExerciceTableur.colors.jaune,\n    },\n  }\n\n  validateFormulas(\n    q: number,\n    userSheet: MySpreadsheetElement,\n  ): { isOk: boolean; messages: string } {\n    // 1. R√©cup√®re les donn√©es de l'utilisateur\n    const userData = userSheet.getData()\n\n    const testSheet = MySpreadsheetElement.create({\n      data: userData,\n      minDimensions: userSheet.getMinDimensions(),\n      style: userSheet.getStyle(),\n      columns: userSheet.getColumns(),\n      interactif: false,\n      id: 'testSheet',\n    })\n    testSheet.style.position = 'absolute'\n    testSheet.style.left = '-9999px'\n    document.body.appendChild(testSheet)\n\n    const messages: string[][] = []\n    for (let n = 0; n < 5; n++) {\n      messages[n] = []\n      const a1 = randint(1, 10)\n      testSheet.setCellValue(0, 0, a1) // A1\n      const resultats = [1, 2, 3].map((i) =>\n        parseFloat(testSheet.getCellValue(i, 0)),\n      )\n\n      // compare les r√©sultats\n      for (let i = 1; i < 4; i++) {\n        if (typeof resultats[i - 1] !== 'number' || isNaN(resultats[i - 1])) {\n          messages[n].push(\n            `La cellule ${String.fromCharCode(65 + i)}1 ne contient pas un nombre valide.<br>`,\n          )\n        }\n      }\n      for (let i = 1; i < 4; i++) {\n        if (\n          typeof testSheet.getCellFormula(i, 0) !== 'string' ||\n          !testSheet.getCellFormula(i, 0).startsWith('=')\n        ) {\n          messages[n].push(\n            `La cellule ${String.fromCharCode(65 + i)}1 ne contient pas une formule valide.<br>`,\n          )\n        }\n      }\n      let result = a1\n      for (let i = 1; i < 4; i++) {\n        const steps = this.listeSteps[q]\n        result = evaluate(result, steps[i - 1].op, steps[i - 1].val)\n        const computed = parseFloat(testSheet.getCellValue(i, 0))\n        if (Math.abs(computed - result) > 1e-9) {\n          messages[n].push(\n            `Pour un nombre de d√©part √©gal √† ${a1}, la cellule ${String.fromCharCode(65 + i)}1 devrait contenir ${texNombre(result, 2)} mais elle contient ${texNombre(computed, 2)}.<br>`,\n          )\n        }\n      }\n    }\n    const maxMessages = messages.reduce(\n      (max, arr) => (arr.length > max.length ? arr : max),\n      [],\n    )\n\n    document.body.removeChild(testSheet)\n    const feedback =\n      maxMessages.length === 0\n        ? '‚úÖ Toutes les formules sont correctes !'\n        : '‚ùå Des erreurs ont √©t√© d√©t√©ct√©es.'\n    return {\n      isOk: maxMessages.length === 0,\n      messages: maxMessages.join('') + feedback,\n    }\n  }\n\n  checkSolution(event?: CustomEvent) {\n    // R√©cup√®re le nom de l‚Äôevent\n    const eventName = event?.type\n    const q = eventName?.match(/Q(\\d+)/)?.[1]\n    if (!q) {\n      console.error('Question number not found in event name:', eventName)\n      return\n    }\n    const id = eventName?.replace('check', 'sheet-') || ''\n    const sheetElt = document.getElementById(id) as MySpreadsheetElement\n    // Tu peux aussi r√©cup√©rer le bouton via event.target ou event.detail\n    // Exemple :\n    // const bouton = event?.detail?.sheet?.querySelector('#runCode')\n\n    if (sheetElt && sheetElt.isMounted()) {\n      const { messages } = this.validateFormulas(Number(q), sheetElt)\n      const messagesDiv = sheetElt.querySelector(\n        '#message-faux',\n      ) as HTMLDivElement\n      if (messages && messagesDiv) {\n        messagesDiv.style.color = 'green'\n        messagesDiv.innerHTML = messages\n      }\n    }\n  }\n\n  nouvelleVersion(): void {\n    // MGu quand l'exercice est modifi√©, on d√©truit les anciens listeners\n    this.destroyers.forEach((destroy) => destroy())\n    this.destroyers.length = 0\n\n    const nbOperations =\n      this.sup === 1 ? randint(2, 5) : Math.min(Math.max(2, this.sup), 5)\n\n    const typesDeOperations = gestionnaireFormulaireTexte({\n      saisie: this.sup2,\n      min: 1,\n      max: 4,\n      melange: 5,\n      defaut: 5,\n      nbQuestions: nbOperations,\n    })\n    this.listeSteps = []\n    const colorsArr = Object.entries(ExerciceTableur.colors)\n    for (\n      let q = 0, cpt = 0, texte, texteCorr: string;\n      q < this.nbQuestions && cpt < 50;\n      cpt++\n    ) {\n      const { steps } = programmeCalcul(typesDeOperations as number[])\n      this.listeSteps[q] = steps\n      const operStr = transformationsOper(steps)\n      const cellDatas: any = {\n        0: {\n          0: { v: steps[0].oldn, s: 'style_id_orange', t: 2 },\n        },\n      }\n      for (let i = 0; i < steps.length; i++) {\n        cellDatas[0][i + 1] = {\n          v: '',\n          s: `style_id_${colorsArr[(i + 1) % colorsArr.length][0]}`,\n        }\n      }\n\n      const data: (number | string)[][] = [[]]\n      data[0][0] = cellDatas[0][0].v\n      for (let i = 0; i < steps.length; i++) {\n        data[0][i + 1] = cellDatas[0][i + 1].v\n      }\n\n      const rect: Record<string, { bg?: string; v?: string }> = {\n        0: { v: steps[0].oldn.toString(), bg: colorsArr[0][1] },\n      }\n      for (let i = 0, k = 1; i < steps.length; i++, k += 2) {\n        rect[`${k}`] = { v: operStr[i] }\n        rect[`${k + 1}`] = { bg: colorsArr[(i + 1) % colorsArr.length][1] }\n      }\n\n      texte = 'On a cr√©√© le programme de calculs suivant :<br>'\n      texte += createDigramm(Object.keys(rect).length, rect) + '<br>'\n\n      texte += `On choisit un nombre dans la premi√®re case, ici ${steps[0].oldn} et on obtient un nombre √† la fin de la cha√Æne.<br><br>      \n      On veut programmer cette suite de calculs dans un tableur. <br>\n      Par exemple, la cellule B1 doit contenir la formule du premier calcul.<br>\n      Faire de m√™me pour les autres cellules. <br>\n      Attention, les formules doivent fonctionner m√™me si le nombre de d√©part change (Cellule A1).<br>\n      `\n      // ${JSON.stringify({rowCount:4,columnCount:steps.length + 1,cellData:data,styles:ExerciceTableur.styles})}\n      if (context.isHtml) {\n        texte += addSheet({\n          numeroExercice: this.numeroExercice ?? 0,\n          question: q,\n          data,\n          minDimensions: [4, 4],\n          style: {\n            A1: `background-color:   ${ExerciceTableur.colors.orange}; font-weight: bold;`,\n            B1: `background-color: ${ExerciceTableur.colors.vert};`,\n            C1: `background-color: ${ExerciceTableur.colors.jaune};`,\n            D1: `background-color: ${ExerciceTableur.colors.bleu};`,\n          },\n          columns: [{ width: 90 }, { width: 90 }, { width: 90 }, { width: 90 }],\n          interactif: this.interactif,\n        })\n      } else {\n        const options: {\n          formule?: boolean\n          formuleTexte?: string\n          formuleCellule?: string\n          firstColHeaderWidth?: string\n        } = {}\n        options.formule = true\n        options.formuleTexte = '=?'\n        options.formuleCellule = 'B1'\n\n        texte += createTableurLatex(\n          2,\n          steps.length + 1,\n          cellDatas,\n          ExerciceTableur.styles,\n          options,\n        )\n      }\n\n      texteCorr = 'Voici les formules √† saisir dans le tableur :<br>'\n      for (let i = 0; i < steps.length; i++) {\n        const step = steps[i]\n        texteCorr += `$${step.oldn} ${operStr[i]} = ${step.result}$ devient en cellule ${alphabet[i + 1]}1 la formule suivante : \"=${alphabet[i]}1${operStr[i].replace('\\\\times', '*').replace('\\\\div', '/')}\"<br>`\n      }\n\n      const listener = () => {\n        const sheets = Array.from(\n          document.querySelectorAll('my-spreadsheet'),\n        ) as MySpreadsheetElement[]\n        for (const sheet of sheets) {\n          const q = sheet.id.match(/Q(\\d+)$/)?.[1]\n\n          const eventName =\n            q !== undefined && this.numeroExercice !== undefined\n              ? `checkEx${this.numeroExercice}Q${q}`\n              : undefined\n          if (sheet && eventName) {\n            const listener = (event: Event) => {\n              this.checkSolution(event as CustomEvent)\n            }\n            sheet.addListener(eventName, listener)\n          } else {\n            console.error(\n              `SheetElement not found or eventName invalid for question ${q} in exercice ${this.numeroExercice}`,\n            )\n          }\n        }\n        document.removeEventListener('exercicesAffiches', listener)\n      }\n      document.addEventListener('exercicesAffiches', listener, { once: true })\n\n      /****************************************************/\n      if (this.questionJamaisPosee(q, texte)) {\n        this.listeQuestions[q] = texte\n        this.listeCorrections[q] = texteCorr\n        q++\n      }\n      listeQuestionsToContenu(this)\n    }\n  }\n\n  correctionInteractive = (i: number) => {\n    if (i === undefined) return ''\n    if (this.answers === undefined) this.answers = {}\n    let result = 'KO'\n    const sheetElement = document.getElementById(\n      `sheet-Ex${this.numeroExercice}Q${i}`,\n    ) as MySpreadsheetElement\n    if (!sheetElement) {\n      console.error(`sheet-Ex${this.numeroExercice}Q${i} not found`)\n      return result\n    }\n    if (sheetElement && sheetElement.isMounted()) {\n      this.answers[`sheet-Ex${this.numeroExercice}Q${i}`] = JSON.stringify(\n        sheetElement.getData(),\n      )\n      const spanResultat = document.querySelector(\n        `#resultatCheckEx${this.numeroExercice}Q${i}`,\n      )\n      const divFeedback = document.querySelector<HTMLElement>(\n        `#feedbackEx${this.numeroExercice}Q${i}`,\n      )\n\n      const { isOk, messages } = this.validateFormulas(i, sheetElement)\n      if (messages.length > 0 && spanResultat && divFeedback) {\n        divFeedback.innerHTML = messages\n        if (!isOk) {\n          if (spanResultat) spanResultat.innerHTML = '‚òπÔ∏è'\n        } else {\n          if (spanResultat) spanResultat.innerHTML = 'üòä'\n          result = 'OK'\n        }\n      }\n    }\n    return result\n  }\n}\n\nfunction transformationsOper(\n  steps: {\n    oldn: number\n    op: number\n    val: number\n    result: number\n  }[],\n) {\n  function stepsToSymbols(\n    steps: {\n      oldn: number\n      op: number\n      val: number\n      result: number\n    }[],\n  ) {\n    const mapOps: Record<number, string> = {\n      1: '+',\n      2: '‚àí', // tiret long pour la soustraction\n      3: '\\\\times',\n      4: '\\\\div',\n    }\n    return steps.map((step) => (mapOps[step.op] || '?') + step.val)\n  }\n  return stepsToSymbols(steps)\n}\n\nfunction evaluate(a: number, op: number, b: number) {\n  if (op === 1) return a + b\n  if (op === 2) return a - b\n  if (op === 3) return a * b\n  if (op === 4) return a / b\n  return NaN\n}\n\n/**\n * G√©n√®re une suite d'op√©rations arithm√©tiques (+, ‚àí, √ó, √∑) appliqu√©es √† un nombre de d√©part,\n * en s‚Äôassurant que chaque op√©ration est valide et que le r√©sultat reste dans des limites acceptables.\n *\n * La fonction m√©lange al√©atoirement l‚Äôordre des op√©rations et choisit les op√©randes de fa√ßon √† ce que\n * chaque √©tape soit faisable (par exemple : pas de r√©sultats n√©gatifs, division donnant un entier, etc.).\n * Elle essaie jusqu‚Äô√† 20 fois de trouver une suite valide.\n *\n * @param operations - Un tableau de nombres repr√©sentant les op√©rations √† effectuer :\n *   1 pour addition (+), 2 pour soustraction (‚àí), 3 pour multiplication (√ó), 4 pour division (√∑).\n *   Par d√©faut : [1, 2, 3, 4].\n *\n * @returns Un objet contenant :\n *   - `ops` : L‚Äôordre final des op√©rations utilis√©es.\n *   - `steps` : Un tableau d‚Äôobjets repr√©sentant chaque √©tape, avec :\n *       - `oldn` : Le nombre avant l‚Äôop√©ration.\n *       - `op` : L‚Äôop√©ration effectu√©e.\n *       - `val` : L‚Äôop√©rande utilis√©e.\n *       - `result` : Le r√©sultat apr√®s l‚Äôop√©ration.\n *   - `final` : Le r√©sultat final apr√®s toutes les op√©rations, ou `null` si √©chec.\n * @example\n *\n * const resultat = programmeCalcul([1, 2, 3, 4]);\n *\n *\n * {\n *   ops: [3, 1, 4, 2], // ordre : √ó puis + puis √∑ puis ‚àí\n *   steps: [\n *     { oldn: 5, op: 3, val: 4, result: 20 }, // 5 √ó 4 = 20\n *     { oldn: 20, op: 1, val: 3, result: 23 }, // 20 + 3 = 23\n *     { oldn: 23, op: 4, val: 1, result: 23 }, // 23 √∑ 1 = 23\n *     { oldn: 23, op: 2, val: 5, result: 18 }  // 23 ‚àí 5 = 18\n *   ],\n *   final: 18\n * }\n */\n\ntype Step = {\n  oldn: number\n  op: number\n  val: number\n  result: number\n}\ntype Steps = Step[]\ntype ProgrammeCalculResult = {\n  ops: number[]\n  steps: Steps\n  final: number | null\n}\nfunction programmeCalcul(\n  operations: number[] = [1, 2, 3, 4],\n): ProgrammeCalculResult {\n  let steps: {\n    oldn: number\n    op: number\n    val: number\n    result: number\n  }[] = []\n  let final = null\n  let ops: number[] = operations\n\n  let k = 0\n  let success = false\n  while (!success && k < 20) {\n    ops = shuffle(ops) // ordre al√©atoire des op√©rations\n    let n = randint(5, 20) // nombre de d√©part\n    steps = [] // les √©tapes de calcul\n    success = true\n    for (let ind = 0, tt = 0; ind < ops.length && tt < 4; ) {\n      if (tt > 0) {\n        // tt : le nombre de tentatives\n        // on change l'ordre des op√©rations si √ßa bloque\n        const firstPart = ops.slice(0, ind)\n        const shuffledPart = shuffle(ops.slice(ind))\n        ops = [...firstPart, ...shuffledPart]\n      }\n      const op = ops[ind]\n      const oldn = n\n      let val: number = 1\n      const oldval: number = ind > 0 ? steps[ind - 1].val : 1\n      if (op === 1) {\n        // +\n        if (50 - n < 2 || (50 - n === 2 && oldval === 2)) {\n          tt++\n          continue\n        } else {\n          val = randint(2, 50 - n, [oldval])\n          n += val\n          ind++\n          tt = 0\n        }\n      } else if (op === 2) {\n        // -\n        if (n < 2 || (n === 2 && oldval === 2)) {\n          tt++\n          continue\n        } else {\n          val = randint(2, n, [oldval])\n          n -= val\n          ind++\n          tt = 0\n        }\n      } else if (op === 3) {\n        // √ó\n        const maxMult = n < 1 ? 5 : Math.floor(50 / n)\n        if (maxMult < 2 || (maxMult === 2 && oldval === 2)) {\n          tt++\n          continue\n        } else {\n          val = randint(2, maxMult, [oldval])\n          n *= val\n          ind++\n          tt = 0\n        }\n      } else if (op === 4) {\n        // √∑\n        const divs = listeDesDiviseurs(n).filter((d) => d > 1 && d < n)\n        if (divs.length === 0 || (divs.length === 1 && divs[0] === oldval)) {\n          tt++\n          continue\n        } else {\n          val = choice<number>(divs, [oldval])\n          n /= val\n          ind++\n          tt = 0\n        }\n      }\n\n      // s√©curit√© bornes\n      if (n < 0 || n > 50 || !Number.isInteger(n)) {\n        tt += 10 // on devrait jamais √™tre ici! donc on sort\n        continue\n      }\n      steps.push({ oldn, op, val, result: n })\n    }\n    if (steps.length !== ops.length) {\n      success = false\n    }\n    if (success) final = n\n    k++\n  }\n\n  return { ops, steps, final }\n}\n\nfunction createDigramm(\n  nbre: number,\n  rects: Record<string, { bg?: string; v?: string }>,\n) {\n  const longueur = 1.8\n  const largeur = 1.5\n  const gap = 0.8\n  const objets = []\n  for (let i = 0; i < nbre; i++) {\n    const A = point(i * longueur + i * gap, 0)\n    const B = point(A.x + longueur, 0)\n    const C = point(B.x, largeur)\n    const D = point(A.x, largeur)\n    const rect = rects[i]\n    const rectangle = polygone(A, B, C, D)\n    if (rect && rect.bg) {\n      rectangle.couleurDeRemplissage = colorToLatexOrHTML(rect.bg)\n      rectangle.opaciteDeRemplissage = 1\n    }\n    objets.push(rectangle)\n    if (rect && rect.v) {\n      const tex = latex2d(`${rect.v}`, (A.x + B.x) / 2, (A.y + D.y) / 2, {\n        color: 'red',\n        backgroundColor: 'none',\n        letterSize: context.isHtml ? 'small' : 'normalsize',\n        orientation: 0,\n        opacity: 1,\n      })\n      objets.push(tex)\n    }\n    if (i > 0) {\n      const seg = segment(A.x - gap, largeur / 2, A.x, largeur / 2, '#f15929')\n      seg.styleExtremites = '->'\n      objets.push(seg)\n    }\n  }\n  const xmin = -0.5\n  const ymin = -0.5\n  const xmax = +longueur * nbre + gap * (nbre - 1) + 0.5\n  const ymax = largeur + 0.5\n\n  return mathalea2d(\n    {\n      xmin,\n      ymin,\n      xmax,\n      ymax,\n      mainlevee: false,\n      scale: context.isHtml ? 1 : 0.5,\n      style: 'margin: auto',\n      optionsTikz: ['baseline=(current bounding box.north)'],\n    },\n    objets,\n  )\n}\n\nfunction createTableurLatex(\n  rowNbr: number,\n  colNbr: number,\n  data: any,\n  styles: any,\n  options: {\n    formule?: boolean\n    formuleTexte?: string\n    formuleCellule?: string\n    firstColHeaderWidth?: string\n  } = {},\n) {\n  let output = `\\\\begin{tabularx}{0.9\\\\linewidth}\n  {|>{\\\\cellcolor{lightgray}}c|\n  ${options.firstColHeaderWidth ? `>{\\\\centering \\\\arraybackslash}p{${options.firstColHeaderWidth}}|` : '>{\\\\centering \\\\arraybackslash}X|'}\n  *{${colNbr - 1}}{>{\\\\centering \\\\arraybackslash}X|}}\\\\hline\\n`\n\n  if (options.formule) {\n    output += `\\\\multicolumn{1}{|l}{${options.formuleCellule}}&\\\\multicolumn{1}{r|}{‚ñº}&\\\\multicolumn{${colNbr - 1}}{l|}{${options.formuleTexte}}\\\\\\\\ \\\\hline\\n`\n  }\n  // en-t√™te\n  output += '\\\\rowcolor{lightgray} &'\n  const alphabet = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'\n  for (let colIndex = 0; colIndex < colNbr - 1; colIndex++) {\n    output += `\\\\textbf{\\\\sffamily ${alphabet[colIndex]}}  & `\n  }\n  output += `\\\\textbf{\\\\sffamily ${alphabet[colNbr - 1]}} \\\\\\\\ \\\\hline\\n`\n\n  for (let rowIndex = 0; rowIndex < rowNbr; rowIndex++) {\n    const rowData = data[rowIndex] || {}\n    output += `\\\\textbf{\\\\sffamily ${rowIndex + 1}} &`\n    for (let colIndex = 0; colIndex < colNbr; colIndex++) {\n      const cell = rowData[colIndex] || {}\n      const styleCell = styles[cell.s ?? ''] || {}\n      let color = ''\n      if (styleCell.bg?.startsWith('#')) {\n        color = `\\\\cellcolor[HTML]{${styleCell.bg.replace('#', '')}}`\n      } else if (styleCell.bg) {\n        color = `\\\\cellcolor{${styleCell.bg}}`\n      }\n      if (cell?.t === 1) {\n        // texte\n        output += `\\\\raggedright ${color} ${cell.v || ''}  &`\n      } else if (cell?.t === 2) {\n        // number\n        output += `\\\\raggedleft ${color} ${cell.v || ''}  &`\n      } else if (cell?.t === 3) {\n        // boolean\n        output += `\\\\centering ${color} ${cell.v ? 'VRAI' : 'FAUX'}  &`\n      } else {\n        output += `${color} ${cell.v || ''}  &`\n      }\n    }\n    output = output.slice(0, -1) // enlever le dernier &\n    output += '\\\\\\\\ \\\\hline\\n'\n  }\n  output += '\\\\end{tabularx}\\n'\n  return output\n}\n"],"names":["MySpreadsheetElement","__publicField","eventName","callback","id","data","minDimensions","style","columns","interactif","elt","container","jspreadsheet","numeroExercice","question","idMatch","feedBackElt","resultCheck","divFeedback","bouton","column","row","value","formula","addSheet","titre","dateDePublication","interactifReady","interactifType","uuid","refs","alphabet","_ExerciceTableur","Exercice","i","result","sheetElement","spanResultat","isOk","messages","destroy","q","userSheet","userData","testSheet","n","a1","randint","resultats","steps","evaluate","computed","texNombre","maxMessages","max","arr","feedback","event","_a","sheetElt","messagesDiv","nbOperations","typesDeOperations","gestionnaireFormulaireTexte","colorsArr","cpt","texte","texteCorr","programmeCalcul","operStr","transformationsOper","cellDatas","rect","k","createDigramm","context","options","createTableurLatex","step","listener","sheets","sheet","listeQuestionsToContenu","ExerciceTableur","stepsToSymbols","mapOps","a","op","b","operations","final","ops","success","shuffle","ind","tt","firstPart","shuffledPart","oldn","val","oldval","maxMult","divs","listeDesDiviseurs","d","choice","nbre","rects","objets","A","point","B","C","D","rectangle","polygone","colorToLatexOrHTML","tex","latex2d","seg","segment","xmin","ymin","xmax","ymax","mathalea2d","rowNbr","colNbr","styles","output","colIndex","rowIndex","rowData","cell","styleCell","color"],"mappings":"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"}
{"version":3,"file":"betaMultiCanvas-YK-iqRrN.js","sources":["../../src/lib/3d/3d_dynamique/multiviewCanvas.ts","../../src/exercices/beta/betaMultiCanvas.ts"],"sourcesContent":["// Exemple : rendu de 4 scènes dans un seul canvas\n// filepath: /Users/lhotejc/mathalea/src/lib/3d/3d_dynamique/MultiViewCanvas.ts\n\nimport { THREE } from './threeInstance'\n\nexport class MultiViewCanvas {\n  canvas: HTMLCanvasElement\n  renderer: THREE.WebGLRenderer\n  scenes: { scene: THREE.Scene; camera: THREE.Camera }[] = []\n\n  constructor(width: number, height: number, nbViews: number) {\n    this.canvas = document.createElement('canvas')\n    this.canvas.width = width\n    this.canvas.height = height\n    this.renderer = new THREE.WebGLRenderer({\n      canvas: this.canvas,\n      antialias: true,\n    })\n    this.renderer.setSize(width, height, false)\n    this.renderer.setClearColor(0xffffff)\n\n    // Crée n scènes/caméras\n    for (let i = 0; i < nbViews; i++) {\n      const scene = new THREE.Scene()\n      const camera = new THREE.PerspectiveCamera(35, width / height, 0.1, 1000)\n      camera.position.set(8, 8, 8)\n      camera.lookAt(0, 0, 0)\n      scene.add(new THREE.AxesHelper(5))\n\n      // Ajoute une lumière\n      const light = new THREE.DirectionalLight(0xffffff, 1)\n      light.position.set(10, 10, 10)\n      scene.add(light)\n\n      // Ajoute un cube\n      const geometry = new THREE.BoxGeometry(2, 2, 2)\n      const material = new THREE.MeshStandardMaterial({ color: 0x44aa88 })\n      const cube = new THREE.Mesh(geometry, material)\n      cube.position.x = i * 3 - nbViews // Décale chaque cube\n      scene.add(cube)\n\n      this.scenes.push({ scene, camera })\n    }\n  }\n\n  render() {\n    const cols = Math.ceil(Math.sqrt(this.scenes.length))\n    const rows = Math.ceil(this.scenes.length / cols)\n    const w = Math.floor(this.canvas.width / cols)\n    const h = Math.floor(this.canvas.height / rows)\n\n    this.renderer.clear()\n    for (let i = 0; i < this.scenes.length; i++) {\n      const col = i % cols\n      const row = Math.floor(i / cols)\n      const x = col * w\n      const y = row * h\n\n      // Définit la zone de rendu\n      this.renderer.setViewport(x, y, w, h)\n      this.renderer.setScissor(x, y, w, h)\n      this.renderer.setScissorTest(true)\n\n      // Met à jour l'aspect de la caméra si c'est une PerspectiveCamera\n      if (this.scenes[i].camera instanceof THREE.PerspectiveCamera) {\n        ;(this.scenes[i].camera as THREE.PerspectiveCamera).aspect = w / h\n        ;(\n          this.scenes[i].camera as THREE.PerspectiveCamera\n        ).updateProjectionMatrix()\n      }\n\n      // Rendu de la scène\n      this.renderer.render(this.scenes[i].scene, this.scenes[i].camera)\n    }\n    this.renderer.setScissorTest(false)\n  }\n\n  /**\n   * Remplace les objets d'une scène (hors caméras et lumières) par ceux fournis.\n   * @param viewIndex Index de la vue à modifier\n   * @param objects Tableau d'objets THREE.Object3D à ajouter\n   */\n  setObjects(viewIndex: number, objects: THREE.Object3D[]) {\n    const { scene } = this.scenes[viewIndex]\n    // Supprime tout sauf les lumières\n    scene.children = scene.children.filter(\n      (obj) =>\n        obj.type === 'DirectionalLight' ||\n        obj.type === 'AmbientLight' ||\n        obj.type === 'PerspectiveCamera' ||\n        obj.type === 'AxesHelper' ||\n        obj.type === 'GridHelper',\n    )\n    // Ajoute les nouveaux objets\n    objects.forEach((obj) => scene.add(obj))\n    this.render()\n  }\n}\n","import { MultiViewCanvas } from '../../lib/3d/3d_dynamique/multiviewCanvas'\nimport { THREE } from '../../lib/3d/3d_dynamique/threeInstance'\nimport { listeQuestionsToContenu } from '../../modules/outils'\nimport Exercice from '../Exercice'\n\nexport const uuid = 'threejs2'\nexport const titre = 'canvas multi vues'\nexport const refs = {\n  'fr-fr': [],\n  'fr-ch': ['NR'],\n}\n\nexport default class BetaThreeJs extends Exercice {\n  version: 'menger' | 'huit-coins'\n  level: number\n\n  constructor() {\n    super()\n    this.version = 'huit-coins' // 'menger' | 'huit-coins'\n    this.level = 1\n    this.listeQuestions = []\n    this.listeCorrections = []\n  }\n\n  nouvelleVersion() {\n    this.listeQuestions = []\n    this.listeCorrections = []\n    const multiView = new MultiViewCanvas(800, 600, 4)\n\n    multiView.render()\n    this.listeQuestions[0] = '<div id=\"div1\"></div>'\n    listeQuestionsToContenu(this)\n\n    // AJOUTER CET ÉVÉNEMENT for initialiser A-Frame après l'affichage\n    document.addEventListener(\n      'exercicesAffiches',\n      () => {\n        const parent = document.getElementById('div1')\n        if (parent !== null) {\n          parent.appendChild(multiView.canvas)\n          multiView.setObjects(0, [\n            new THREE.Mesh(\n              new THREE.BoxGeometry(),\n              new THREE.MeshStandardMaterial({ color: 0xff0000 }),\n            ),\n          ])\n          multiView.setObjects(1, [\n            new THREE.Mesh(\n              new THREE.SphereGeometry(),\n              new THREE.MeshStandardMaterial({ color: 0x00ff00 }),\n            ),\n          ])\n          multiView.setObjects(2, [\n            new THREE.Mesh(\n              new THREE.CylinderGeometry(),\n              new THREE.MeshStandardMaterial({ color: 0x0000ff }),\n            ),\n          ])\n          multiView.setObjects(3, [\n            new THREE.Mesh(\n              new THREE.PlaneGeometry(),\n              new THREE.MeshStandardMaterial({ color: 0xffff00 }),\n            ),\n          ])\n          multiView.render()\n        } else {\n          console.info('div1 pas trouvé')\n        }\n      },\n      { once: true },\n    )\n  }\n}\n"],"names":["MultiViewCanvas","width","height","nbViews","__publicField","THREE.WebGLRenderer","i","scene","THREE.Scene","camera","THREE.PerspectiveCamera","THREE.AxesHelper","light","THREE.DirectionalLight","geometry","THREE.BoxGeometry","material","THREE.MeshStandardMaterial","cube","THREE.Mesh","cols","rows","w","h","col","row","x","y","viewIndex","objects","obj","uuid","titre","refs","BetaThreeJs","Exercice","multiView","listeQuestionsToContenu","parent","THREE.SphereGeometry","THREE.CylinderGeometry","THREE.PlaneGeometry"],"mappings":"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"}
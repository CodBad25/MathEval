{"version":3,"file":"sandboxCE-DpMl3Kyj.js","sources":["../../src/exercices/ressources/sandboxCE.ts"],"sourcesContent":["import './styleSandbox.scss'\nimport { MathfieldElement, type Expression } from 'mathlive'\nimport { ComputeEngine, type BoxedExpression } from '@cortex-js/compute-engine'\n\nexport type FOrmatValue =\n  | 'litteral'\n  | 'numerique'\n  | 'fonction'\n  | 'liste'\n  | 'fraction'\n\ninterface ILitteralValues {\n  developper?: boolean\n  simplifier?: boolean\n  ordonner?: boolean\n  deriver?: boolean\n  compiler?: boolean\n}\n\ninterface IFractionValues {\n  irreductible: boolean\n  forcerdecimalenrationnel: boolean\n  fractionplussimple: boolean\n}\n\ninterface INumeriqueValues {\n  // puissance: boolean,\n  notation: string\n}\n\ninterface IListeValues {\n  ordonnee: boolean\n  croissant: boolean\n  eliminedoublons: boolean\n}\n\ninterface IFonctionValues {\n  deriver: boolean\n  simplifier: boolean\n}\n\nconst litteralOptionsValues = [\n  'développer',\n  'simplifier',\n  'dériver',\n  'compiler',\n]\nconst numeriqueOptionsValue: [string, string, string][] = [\n  ['notation', 'scientifique', 'ingénieure'],\n]\nconst fractionOptionsValues = [\n  'irréductible',\n  'forcer décimal en rationnel',\n  'fraction plus simple',\n]\nconst listeOptionsValues = ['ordonnée', 'croissant', 'élimine doublons']\nconst fonctionOptionsValues = ['simplifier', 'dériver']\n\ninterface IOptionFormat {\n  litteral?: ILitteralValues\n  fraction?: IFractionValues\n  fonction?: IFonctionValues\n  liste?: IListeValues\n  numerique?: INumeriqueValues\n}\n\nconst ce = new ComputeEngine()\nce.latexOptions.decimalMarker = '{,}'\n// ce.latexOptions.avoidExponentsInRange = [-9, 9]\nce.latexOptions.exponentProduct = '\\\\times'\n// ce.latexOptions.fractionStyle = ()=>\"display-quotient\"\n\nconst gcd = function (a: number, b: number): number {\n  if (!Number.isInteger(a)) a = Math.round(a)\n  if (!Number.isInteger(b)) b = Math.round(b)\n  if (!b) {\n    return a\n  }\n  return gcd(b, a % b)\n}\n\n/*\nce.jsonSerializationOptions = {\n    metadata: [\"latex\"]\n}\n*/\nfunction cleanDivTexContent(parent: HTMLDivElement) {\n  for (const child of Array.from(parent.children)) {\n    if (child.children.length > 0 && child instanceof HTMLDivElement)\n      cleanDivTexContent(child)\n    else {\n      if (child.textContent !== '') {\n        child.textContent = ''\n      }\n    }\n  }\n}\n\n/**\n * La fonction qui effectue les vérifications en aiguillant vers les bonnes procédures (beaucoup restent à implémenter)\n * @param saisie\n * @param reponse\n * @param saisieCanonical\n * @param reponseCanonical\n * @param isEqual\n * @param formatSelector\n * @param optionsFormatSaisie\n * @param optionsFormatReponse\n */\nfunction compare(\n  saisie: string,\n  reponse: string,\n  {\n    saisieCanonical,\n    reponseCanonical,\n    isEqual,\n    formatSelector,\n    optionsFormatSaisie,\n    optionsFormatReponse,\n  }: {\n    saisieCanonical: boolean\n    reponseCanonical: boolean\n    isEqual: boolean\n    formatSelector: FOrmatValue\n    optionsFormatSaisie: IOptionFormat\n    optionsFormatReponse: IOptionFormat\n  },\n): boolean {\n  if (formatSelector === 'fraction') {\n    saisieCanonical = false\n    reponseCanonical = false\n  }\n  const feedback = document.querySelector<HTMLDivElement>('div#feedback')\n\n  let saisieCompilee: ((args: Record<string, unknown>) => unknown) | undefined\n  let reponseCompilee: ((args: Record<string, unknown>) => unknown) | undefined\n  let saisieFinaleLatex: string\n  let reponseFinaleLatex: string\n  let notationSaisie: string | undefined\n  let notationReponse: string | undefined\n  // On nettoie le div 'feedback' du message précédent\n  if (feedback != null) cleanDivTexContent(feedback)\n  // on récupère le contenu des champs Mathlive\n  // let numSaisie, denSaisie, numReponse, denReponse\n  let saisieParsed: BoxedExpression\n  let reponseParsed: BoxedExpression\n  let result: boolean\n  // On aiguille vers la bonne fonction de vérification qui va appliquer les options sélectionnées\n  switch (formatSelector) {\n    case 'litteral':\n      saisieParsed = ce.parse(saisie, { canonical: saisieCanonical })\n      reponseParsed = ce.parse(reponse, { canonical: reponseCanonical })\n      if (optionsFormatSaisie.litteral) {\n        if (optionsFormatSaisie.litteral.developper) {\n          saisieParsed = ce.box(['Expand', saisieParsed]).evaluate()\n        }\n        if (optionsFormatSaisie.litteral.simplifier) {\n          saisieParsed = saisieParsed.simplify()\n        }\n        // Pour l'instant l'option n'est pas encore disponible dans Compute-engine, donc elle est retiré en attendant des choix possibles.\n        if (optionsFormatSaisie.litteral.deriver) {\n          alert(\n            \"Attention ! la dérivée n'est fonctionnelle que pour les polynômes.\",\n          )\n          saisieParsed = ce.box(['D', saisieParsed, 'x']).evaluate()\n        }\n        if (optionsFormatSaisie.litteral.compiler) {\n          saisieCompilee = saisieParsed.compile()\n        }\n      }\n      saisieFinaleLatex = saisieParsed.latex\n      if (optionsFormatReponse.litteral) {\n        if (optionsFormatReponse.litteral.developper) {\n          // @todo comprendre comment ça fonctionne\n          reponseParsed = ce.box(['Expand', reponseParsed]).evaluate()\n        }\n        if (optionsFormatReponse.litteral.simplifier) {\n          reponseParsed = reponseParsed.simplify()\n        }\n        if (optionsFormatReponse.litteral.deriver) {\n          // @todo comprendre comment ça fonctionne\n          reponseParsed = ce.box(['Derivative', reponseParsed, 'x']).evaluate()\n        }\n        if (optionsFormatReponse.litteral.compiler) {\n          // @todo comprendre comment ça fonctionne\n          reponseCompilee = reponseParsed.compile()\n        }\n      }\n      reponseFinaleLatex = reponseParsed.latex\n      break\n    case 'numerique':\n      notationSaisie = optionsFormatSaisie.numerique?.notation\n      if (notationSaisie) {\n        if (notationSaisie === 'scientifique') {\n          ce.latexOptions.notation = 'scientific'\n          ce.latexOptions.avoidExponentsInRange = [0, 0]\n        } else if (notationSaisie === 'ingénieure') {\n          ce.latexOptions.notation = 'engineering'\n          ce.latexOptions.avoidExponentsInRange = [0, 0]\n        } else {\n          ce.latexOptions.notation = 'auto'\n          ce.latexOptions.avoidExponentsInRange = [-9, 9]\n        }\n      }\n      saisieParsed = ce.parse(saisie, { canonical: saisieCanonical })\n      saisieFinaleLatex = saisieParsed.latex\n      notationReponse = optionsFormatReponse.numerique?.notation\n      if (notationReponse) {\n        if (notationReponse === 'scientifique') {\n          ce.latexOptions.notation = 'scientific'\n          ce.latexOptions.avoidExponentsInRange = [0, 0]\n        } else if (notationReponse === 'ingénieure') {\n          ce.latexOptions.notation = 'engineering'\n          ce.latexOptions.avoidExponentsInRange = [0, 0]\n        } else {\n          ce.latexOptions.notation = 'auto'\n          ce.latexOptions.avoidExponentsInRange = [-9, 9]\n        }\n      }\n      reponseParsed = ce.parse(reponse, { canonical: reponseCanonical })\n      reponseFinaleLatex = reponseParsed.latex\n      break\n    case 'liste': // @todo à implémenter\n    case 'fonction': // @todo à implémenter\n    case 'fraction':\n    default:\n      if (optionsFormatSaisie.fraction?.forcerdecimalenrationnel) {\n        ce.latexOptions.parseNumbers = 'rational'\n      }\n      reponseParsed = ce.parse(reponse, { canonical: false })\n      saisieParsed = ce.parse(saisie, { canonical: false })\n      if (optionsFormatSaisie.fraction?.forcerdecimalenrationnel) {\n        isEqual = true\n      } else {\n        isEqual = true\n        if (optionsFormatSaisie.fraction?.irreductible) {\n          reponseParsed = reponseParsed.canonical\n        }\n      }\n      saisieFinaleLatex = saisieParsed.latex\n      reponseFinaleLatex = reponseParsed.latex\n      break\n  }\n  if (formatSelector === 'fraction') {\n    if (optionsFormatSaisie.fraction?.fractionplussimple) {\n      const num1 = saisieParsed.op1.numericValue\n      const num2 = reponseParsed.op1.numericValue\n      if (num1 != null && num2 != null) {\n        result = saisieParsed.isEqual(reponseParsed)\n        result = result && num1 < num2\n      } else {\n        console.warn(\n          `On a un problème avec l'un des deux numérateurs : numSaisie = ${num1} et numReponse = ${num2} `,\n        )\n        result = false\n      }\n    } else if (optionsFormatSaisie.fraction?.irreductible) {\n      const numSaisie = Number(saisieParsed.op1.numericValue)\n      const denSaisie = Number(saisieParsed.op2.numericValue)\n      const irreductible = gcd(numSaisie, denSaisie) === 1\n      result = irreductible && saisieParsed.isEqual(reponseParsed)\n    } else {\n      // ni irreductible, ni plus simple,\n      result = saisieParsed.isEqual(reponseParsed)\n    }\n  } else {\n    result = isEqual\n      ? saisieParsed.isEqual(reponseParsed)\n      : saisieParsed.isSame(reponseParsed)\n  }\n  // On connait la réponse, on va maintenant rendre compte dans les différents éléments de feedback.\n  const resultatSaisie = document.querySelector('#resultatSaisie')\n  const resultatReponse = document.querySelector('#resultatReponse')\n  if (resultatSaisie && resultatReponse) {\n    resultatSaisie.textContent = `${saisieFinaleLatex}`\n    resultatReponse.textContent = `${reponseFinaleLatex}`\n  }\n\n  if (feedback != null) {\n    // c'est pour pas que ts râle feedback est dans la page html.\n    const p1 = document.querySelector('div#conclusion')\n    if (p1)\n      p1.appendChild(\n        document.createTextNode(\n          `Comparaison de la saisie élève [${saisieParsed.json}] soit ${saisieParsed.latex} et de la réponse [${reponseParsed.json}] soit ${reponseParsed.latex} en utilisant la méthode ${isEqual ? 'isEqual()' : 'isSame()'} avec le processus de traitement pour le format ${formatSelector} : ${String(result)}`,\n        ),\n      )\n    if (saisieCompilee) {\n      const div1 = document.querySelector('div#saisieCompile')\n      if (div1)\n        div1.appendChild(\n          document.createTextNode(`saisie compilée : ${saisieCompilee}`),\n        )\n    }\n    if (reponseCompilee) {\n      const div2 = document.querySelector('div#reponseCompile')\n      if (div2)\n        div2.appendChild(\n          document.createTextNode(`réponse compilée : ${reponseCompilee}`),\n        )\n    }\n  }\n  // alert(`Résultat de la comparaison = ${result}`)\n  return result\n}\n\nexport const uuid = 'sandboxCE'\nexport const titre = 'Compute-engine sandbox'\n\nclass ComputeEngineSandbox {\n  typeExercice: string\n  numeroExercice!: number\n  sup!: string\n  titre: string\n  container: HTMLDivElement\n\n  constructor() {\n    this.typeExercice = 'html'\n    this.titre = 'Compute-engine sandbox'\n    this.container = document.createElement('div')\n    this.container.setAttribute('overflow', 'auto')\n    const mathVirtualKeyboard = window.mathVirtualKeyboard\n    this.container.id = 'sandbox'\n    this.container.innerHTML = `<table id=\"table1\">\n        <thead>\n        <tr>\n            <th colspan=\"3\">\n                <h2>Saisir deux expressions puis choisir le type de comparaison</h2>\n            </th>\n        </tr>\n        <tr>\n            <td>\n             <label>Type de comparaison :\n                    <select id=\"format\">\n                        <option>littéral</option>\n                        <option>numérique</option>\n                        <option>fraction</option>\n                        <option>liste</option>\n                        <option>fonction</option>\n                    </select>\n                </label>\n</td>\n<td>    </td>\n     <td>séparateur décimal\n     <form id=\"sep\">\n     <input type=\"radio\" name=\"sep\" value=\"virgule\" checked><label>virgule</label></input>\n     <input type=\"radio\" name=\"sep\" value=\"point\"><label>point</label></input>\n</form>\n</td>          \n        </tr>\n        </thead>\n        <tbody>\n        <tr>\n            <td><h3>Saisie élève</h3></td>\n            <td><h3>Réponse attendue</h3></td>\n            <td><h3>Résultat de la comparaison</h3></td>\n        </tr>\n        <tr>\n            <td id=\"saisie\"></td>\n            <td id=\"reponse\"></td>\n            <td id=\"resultat\">true</td>\n        </tr>\n        <tr>\n            <td id=\"optionsSaisie\"></td>\n            <td id=\"optionsReponse\"></td>\n        </tr>\n        <tr>\n            <th>Rendre canonique la saisie élève ?</th>\n            <th>Rendre canonique la réponse attendue ?</th>\n            <th>Utiliser isSame() ou isEqual() ?</th>\n        </tr>\n        <tr>\n            <th>\n                <form id='canonicalSaisie'>\n                    <label><input type='radio' name='canonicalSaisie' value='true' checked>True</label><br>\n                    <label><input type='radio' name='canonicalSaisie' value='false'>False</label>\n                </form>\n            </th>\n            <th>\n                <form id='canonicalReponse'>\n                    <label><input type='radio' name='canonicalReponse' value='true' checked>True</label><br>\n                    <label><input type='radio' name='canonicalReponse' value='false'>False</label>\n                </form>\n            </th>\n            <th>\n                <form id=\"isEqual\">\n                    <label><input type='radio' name='isEqual' value='true' checked>isEqual()</label><br>\n                    <label><input type='radio' name='isEqual' value='false'>isSame()</label>\n                </form>\n            </th>\n        </tr>\n        <tr>\n\n        </tr>\n        <tr>\n            <th colspan=\"2\">\n                résultat après traitement\n            </th>\n        </tr>\n        <tr>\n            <th id=\"resultatSaisie\">\n                &nbsp;\n            </th>\n            <th id=\"resultatReponse\">\n                &nbsp;\n            </th>\n        </tr>\n        </tbody>\n    </table>\n    <div id=\"feedback\" style=\"display: block\">\n        <div id=\"conclusion\"></div>\n        <div id=\"divCompile\" style=\"display: inline\">\n            <div id=\"saisieCompile\" style=\"display: inline\"></div>\n            &nbsp;&nbsp;\n            <div id=\"reponseCompile\" style=\"display: inline\"></div>\n        </div>\n    </div>\n`\n    const inputSep = this.container.querySelector<HTMLFormElement>('#sep')\n    const formSaisieCanonical =\n      this.container.querySelector<HTMLFormElement>('#canonicalSaisie')\n    const formReponseCanonical =\n      this.container.querySelector<HTMLFormElement>('#canonicalReponse')\n    const optionsSaisie =\n      this.container.querySelector<HTMLTableCellElement>('#optionsSaisie')\n    const optionsReponse =\n      this.container.querySelector<HTMLTableCellElement>('#optionsReponse')\n    const formIsEqual =\n      this.container.querySelector<HTMLFormElement>('#isEqual')\n    const radioSaisieCanonical = formSaisieCanonical?.querySelectorAll('input')\n    const radioReponseCanonical =\n      formReponseCanonical?.querySelectorAll('input')\n    const radioIsEqual = formIsEqual?.querySelectorAll('input')\n    const cellSaisie =\n      this.container.querySelector<HTMLTableCellElement>('#saisie')\n    const cellReponse =\n      this.container.querySelector<HTMLTableCellElement>('#reponse')\n    const cellResultat =\n      this.container.querySelector<HTMLTableCellElement>('#resultat')\n    const formatSelector =\n      this.container.querySelector<HTMLSelectElement>('#format')\n    // les options pour chaque format (à implémenter)\n\n    // initialisation des variables\n    let saisieCanonical = false\n    let reponseCanonical = false\n    let isEqual = false\n    let optionsFormatSaisie: IOptionFormat\n    let optionsFormatReponse: IOptionFormat\n\n    // MathfieldElement.fontsDirectory = '../assets/fonts'\n    // MathfieldElement.soundsDirectory = '../assets/sounds'\n    MathfieldElement.decimalSeparator = ','\n\n    // On crée les deux inputs Mathlive et on active le clavier au focus (on le vire au focusout)\n    const saisie = new MathfieldElement()\n    const reponse = new MathfieldElement()\n    saisie.mathVirtualKeyboardPolicy = 'manual'\n    reponse.mathVirtualKeyboardPolicy = 'manual'\n    saisie.addEventListener('focusin', () => mathVirtualKeyboard.show())\n    reponse.addEventListener('focusin', () => mathVirtualKeyboard.show())\n    saisie.addEventListener('focusout', () => mathVirtualKeyboard.hide())\n    reponse.addEventListener('focusout', () => mathVirtualKeyboard.hide())\n\n    // Les deux formulaires pour les options de format\n    const formOptionsSaisie: HTMLFormElement = document.createElement('form')\n    const formOptionsReponse: HTMLFormElement = document.createElement('form')\n\n    /**\n     * Une fonction pour nettoyer les zones d'options\n     */\n    function cleanOptions() {\n      if (optionsSaisie && formOptionsSaisie) {\n        for (const child of Array.from(formOptionsSaisie.children)) {\n          formOptionsSaisie.removeChild(child)\n        }\n        for (const child of Array.from(optionsSaisie.children)) {\n          optionsSaisie.removeChild(child)\n        }\n      }\n      if (optionsReponse && formOptionsReponse) {\n        for (const child of Array.from(formOptionsReponse.children)) {\n          formOptionsReponse.removeChild(child)\n        }\n        for (const child of Array.from(optionsReponse.children)) {\n          optionsReponse.removeChild(child)\n        }\n      }\n    }\n\n    /**\n     * crée un label contenant un input de type checkbox pour le formulaire de même nom que le label\n     * @param label\n     * @param value\n     * @param checked\n     */\n    function addCheckbox(label: string, value: string, checked: boolean) {\n      const lab1 = document.createElement('label')\n      const textContent = document.createTextNode(label)\n      const input1 = document.createElement('input')\n      input1.addEventListener('change', () => updateResultat())\n      input1.type = 'checkbox'\n      input1.value = value\n      input1.checked = checked\n      input1.name = value\n      lab1.appendChild(input1)\n      lab1.appendChild(textContent)\n      return lab1\n    }\n\n    function addRadios(label: [string, string, string], checked: boolean) {\n      const lab1 = document.createElement('label')\n      const textContent = document.createTextNode(label[0] + ' : ')\n      const input1 = document.createElement('input')\n      input1.addEventListener('change', () => updateResultat())\n      input1.type = 'radio'\n      input1.value = label[1]\n      input1.checked = checked\n      input1.name = label[0]\n      const input2 = document.createElement('input')\n      input2.addEventListener('change', () => updateResultat())\n      input2.type = 'radio'\n      input2.value = label[2]\n      input2.checked = false\n      input2.name = label[0]\n      const text1 = document.createTextNode(label[1])\n      const text2 = document.createTextNode(label[2])\n      lab1.appendChild(textContent)\n      lab1.appendChild(input1)\n      lab1.appendChild(text1)\n      lab1.appendChild(input2)\n      lab1.appendChild(text2)\n      return lab1\n    }\n\n    /**\n     * Ajoute les différents label/inputs à chaque formulaire pour les options de format\n     * @param {boolean} onlySaisie si true, il n'y aura pas de cases à cocher sur la réponse\n     * @param {strings} labels les différentes options du format.\n     */\n    function renseigneOptions(\n      onlySaisie: boolean,\n      ...labels: string[] | [string, string, string][]\n    ) {\n      cleanOptions()\n      for (const label of labels) {\n        const element = Array.isArray(label)\n          ? addRadios(label, false)\n          : addCheckbox(\n              label,\n              label.replaceAll('é', 'e').replaceAll(/\\s/g, ''),\n              false,\n            )\n        formOptionsSaisie.appendChild(element)\n        formOptionsSaisie.appendChild(document.createElement('br'))\n        if (!onlySaisie) {\n          formOptionsReponse.appendChild(\n            Array.isArray(label)\n              ? addRadios(label, false)\n              : addCheckbox(\n                  label,\n                  label.replaceAll('é', 'e').replaceAll(/\\s/g, ''),\n                  false,\n                ),\n          )\n          formOptionsReponse.appendChild(document.createElement('br'))\n        }\n      }\n    }\n\n    /**\n     * met à jour les options du format (appelé à chaque changement de format et à l'init avec la valeur 'littéral')\n     * @param format\n     */\n    function updateOptions(format: string) {\n      if (format) {\n        if (optionsSaisie && optionsReponse) {\n          switch (format) {\n            case 'littéral': // mise en place des checkboxes de configuration du format littéral\n              renseigneOptions(false, ...litteralOptionsValues)\n              break\n            case 'numérique':\n              renseigneOptions(false, ...numeriqueOptionsValue)\n              break\n            case 'fonction':\n              renseigneOptions(false, ...fonctionOptionsValues)\n              break\n            case 'liste':\n              renseigneOptions(false, ...listeOptionsValues)\n              break\n            case 'fraction':\n              renseigneOptions(true, ...fractionOptionsValues)\n              break\n            default:\n              cleanOptions()\n              throw Error(\n                `Le sélecteur de format a rencontré une valeur imprévue : ${formatSelector?.value}`,\n              )\n          }\n          optionsSaisie.appendChild(formOptionsSaisie)\n          optionsReponse.appendChild(formOptionsReponse)\n        }\n      }\n    }\n\n    // Mise en place des listeners sur les différents éléments qui provoque un changement\n    if (formatSelector) {\n      // sélecteur de format\n      formatSelector.addEventListener('change', () => {\n        if (formatSelector?.value === 'fraction') {\n          alert(\n            'En format \"fraction\", le test se fait toujours avec isEqual, et l\\'option canonical à false.\\nSi l\\'option \"forcer décimal en rationnel\" est active, les nombres décimaux sont convertis en fractions décimales.\\nLes options permettent d\\'affiner le test.',\n          )\n          if (formReponseCanonical) {\n            const inputs = Array.from(\n              formReponseCanonical.querySelectorAll('input'),\n            )\n            if (inputs[1]) inputs[1].checked = true\n          }\n        }\n        updateOptions(formatSelector.value)\n      })\n    }\n\n    if (inputSep) {\n      const jsonChange = ({\n        from,\n        to,\n        json,\n      }: {\n        from: string\n        to: string\n        json: Expression | string\n      }) => {\n        if (Array.isArray(json)) {\n          for (const element of json) {\n            jsonChange({ from, to, json: element })\n          }\n        } else if (typeof json === 'string') {\n          json.replaceAll(from, to)\n        }\n      }\n      inputSep.addEventListener('change', () => {\n        const buttons = Array.from(inputSep.querySelectorAll('input'))\n        const saisieExp = saisie.expression\n        const reponseExp = reponse.expression\n        if (Array.isArray(buttons) && buttons.length > 0) {\n          const button = buttons.find((el) => el?.checked)\n          if (button) {\n            const separator = button.value\n            if (separator === 'virgule') {\n              MathfieldElement.decimalSeparator = ','\n              jsonChange({ from: '.', to: ',', json: saisieExp })\n              jsonChange({ from: '.', to: ',', json: reponseExp })\n              saisie.expression = saisieExp\n              reponse.expression = reponseExp\n            } else {\n              MathfieldElement.decimalSeparator = '.'\n              jsonChange({ from: ',', to: '.', json: saisieExp })\n              jsonChange({ from: ',', to: '.', json: reponseExp })\n              saisie.expression = saisieExp\n              reponse.expression = reponseExp\n            }\n          }\n        }\n      })\n    }\n\n    if (formSaisieCanonical) {\n      // radios forme canonique saisie\n      formSaisieCanonical.addEventListener('change', () => {\n        if (formatSelector?.value === 'fraction') {\n          alert(\n            'En format \"fraction\", le test se fait avec isEqual, l\\'option canonical à false.\\nLes options permettent de configurer plus finement le test.\\nDe plus, si l\\'option \"forcer décimal en rationnel\" est active, les nombres décimaux sont convertis en fraction décimale avant le test.',\n          )\n          const inputs = Array.from(\n            formSaisieCanonical.querySelectorAll('input'),\n          )\n          if (inputs[1]) inputs[1].checked = true\n          return\n        }\n        if (radioSaisieCanonical)\n          saisieCanonical = Boolean(radioSaisieCanonical[0]?.checked)\n        updateResultat()\n      })\n    }\n    if (formReponseCanonical) {\n      // radios forme canonique réponse\n      formReponseCanonical.addEventListener('change', () => {\n        if (formatSelector?.value === 'fraction') {\n          alert(\n            'En format \"fraction\", l\\'option canonical reste à false car sinon, cela provoque la réduction de la fraction.',\n          )\n          const inputs = Array.from(\n            formReponseCanonical.querySelectorAll('input'),\n          )\n          if (inputs[1]) inputs[1].checked = true\n          return\n        }\n        if (radioReponseCanonical)\n          reponseCanonical = Boolean(radioReponseCanonical[0]?.checked)\n        updateResultat()\n      })\n    }\n    if (formIsEqual) {\n      // radios isEqual/isSame\n      formIsEqual.addEventListener('change', () => {\n        if (\n          radioIsEqual &&\n          formatSelector &&\n          formatSelector.value === 'fraction'\n        ) {\n          const optionsSaisie = document.querySelector('#optionsSaisie')\n          if (optionsSaisie) {\n            const formSaisie = optionsSaisie.firstChild as HTMLFormElement\n            const elements = formSaisie.elements\n            // const irreductible = (elements[0] as HTMLInputElement).checked\n            const accepterDecimal = (elements[1] as HTMLInputElement).checked\n            // const plusSimple = (elements[2] as HTMLInputElement).checked\n            if (accepterDecimal) {\n              // On accepte une valeur décimale même si irreductible ou plusSimple sont cochés... c'est pour faire des tests.\n              // En théorie, si on veut une fraction irréductible, on ne tolérera pas les décimaux.\n              isEqual = true\n              if (radioIsEqual[0] && radioIsEqual[1]) {\n                radioIsEqual[0].checked = true\n                radioIsEqual[1].checked = false\n              }\n            } else {\n              isEqual = false\n              if (radioIsEqual[0] && radioIsEqual[1]) {\n                radioIsEqual[1].checked = true\n                radioIsEqual[0].checked = false\n              }\n            }\n          }\n        } else if (radioIsEqual) isEqual = Boolean(radioIsEqual[0]?.checked)\n        updateResultat()\n      })\n    }\n    if (saisie) {\n      // champ de saisie Mathlive\n      saisie.addEventListener('change', () => {\n        updateResultat()\n      })\n    }\n    if (reponse) {\n      // champ de réponse Mathlive\n      reponse.addEventListener('change', () => {\n        updateResultat()\n      })\n    }\n\n    /**\n     * La fonction qui met à jour le résultat de la comparaison...\n     */\n    function updateResultat() {\n      optionsFormatSaisie = {}\n      optionsFormatReponse = {}\n      let property: FOrmatValue\n      if (formatSelector) {\n        const format = formatSelector.value\n        if (\n          ['littéral', 'fraction', 'fonction', 'numérique', 'liste'].includes(\n            format,\n          )\n        ) {\n          property = format\n            .replaceAll('é', 'e')\n            .replaceAll(/\\s/g, '') as FOrmatValue\n          const propsSaisie = (\n            Array.from(formOptionsSaisie.elements) as HTMLInputElement[]\n          )\n            .filter((elt) => elt.checked)\n            .map((elt) => {\n              return elt.name === 'notation'\n                ? [elt.name, elt.value]\n                : [elt.name, true]\n            })\n          const propsReponse = (\n            Array.from(formOptionsReponse.elements) as HTMLInputElement[]\n          )\n            .filter((elt) => elt.checked)\n            .map((elt) => {\n              return elt.name === 'notation'\n                ? [elt.name, elt.value]\n                : [elt.name, true]\n            })\n          const objetSaisie = [property, Object.fromEntries(propsSaisie)]\n          const objetReponse = [property, Object.fromEntries(propsReponse)]\n          optionsFormatSaisie = Object.fromEntries([objetSaisie])\n          optionsFormatReponse = Object.fromEntries([objetReponse])\n          if (cellResultat) {\n            const resultat = compare(saisie.value, reponse.value, {\n              saisieCanonical,\n              reponseCanonical,\n              isEqual,\n              formatSelector: property,\n              optionsFormatSaisie,\n              optionsFormatReponse,\n            })\n            cellResultat.innerText = String(resultat)\n          }\n        }\n      }\n    }\n\n    // Mise en place des inputMathlive dans la table\n    if (cellSaisie) cellSaisie.appendChild(saisie)\n    if (cellReponse) cellReponse.appendChild(reponse)\n\n    updateOptions('littéral') // à la mise en route, on est en format 'littéral'\n  }\n\n  get html() {\n    return this.container\n  }\n}\nexport default ComputeEngineSandbox\n\n// Les éléments à piloter\n\n// Les éléments à piloter\n"],"names":["litteralOptionsValues","numeriqueOptionsValue","fractionOptionsValues","listeOptionsValues","fonctionOptionsValues","ce","ComputeEngine","gcd","a","b","cleanDivTexContent","parent","child","compare","saisie","reponse","saisieCanonical","reponseCanonical","isEqual","formatSelector","optionsFormatSaisie","optionsFormatReponse","feedback","saisieCompilee","reponseCompilee","saisieFinaleLatex","reponseFinaleLatex","notationSaisie","notationReponse","saisieParsed","reponseParsed","result","_a","_b","_c","_d","_e","_f","num1","num2","_g","numSaisie","denSaisie","resultatSaisie","resultatReponse","p1","div1","div2","uuid","titre","ComputeEngineSandbox","__publicField","mathVirtualKeyboard","inputSep","formSaisieCanonical","formReponseCanonical","optionsSaisie","optionsReponse","formIsEqual","radioSaisieCanonical","radioReponseCanonical","radioIsEqual","cellSaisie","cellReponse","cellResultat","MathfieldElement","formOptionsSaisie","formOptionsReponse","cleanOptions","addCheckbox","label","value","checked","lab1","textContent","input1","updateResultat","addRadios","input2","text1","text2","renseigneOptions","onlySaisie","labels","element","updateOptions","format","inputs","jsonChange","from","to","json","buttons","saisieExp","reponseExp","button","el","property","propsSaisie","elt","propsReponse","objetSaisie","objetReponse","resultat"],"mappings":"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"}
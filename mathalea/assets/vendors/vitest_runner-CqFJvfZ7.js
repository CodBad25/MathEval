var K=Object.defineProperty;var Q=(t,e,n)=>e in t?K(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var x=(t,e,n)=>Q(t,typeof e!="symbol"?e+"":e,n);import{g as Y,h as z,i as N,o as J,j as X,k as q,p as Z}from"./vitest_utils-CZP3wGXz.js";function W(t,e){function n(o){const i=function(...s){return e.apply(o,s)};Object.assign(i,e),i.withContext=()=>i.bind(o),i.setContext=(s,c)=>{o[s]=c},i.mergeContext=s=>{Object.assign(o,s)};for(const s of t)Object.defineProperty(i,s,{get(){return n({...o,[s]:!0})}});return i}const r=n({});return r.fn=e,r}function Ft(t){const e=[t.name];let n=t;for(;n!=null&&n.suite||n!=null&&n.file;)n=n.suite||n.file,n!=null&&n.name&&e.unshift(n.name);return e}const O=new WeakMap,D=new WeakMap,L=new WeakMap;function tt(t,e){O.set(t,e)}function et(t,e){D.set(t,e)}function nt(t){return D.get(t)}function rt(t,e){L.set(t,e)}function ot(t){return L.get(t)}class st extends Error{constructor(n,r){super(n);x(this,"code","VITEST_PENDING");x(this,"taskId");this.message=n,this.taskId=r.id}}const F={currentSuite:null};function it(t){var e;(e=F.currentSuite)==null||e.tasks.push(t)}async function ct(t,e){const n=F.currentSuite;F.currentSuite=t,await e(),F.currentSuite=n}function R(t,e,n=!1){if(e<=0||e===Number.POSITIVE_INFINITY)return t;const{setTimeout:r,clearTimeout:o}=Y();return(...i)=>Promise.race([t(...i),new Promise((s,c)=>{var a;const h=r(()=>{o(h),c(new Error(at(n,e)))},e);(a=h.unref)==null||a.call(h)})])}function ut(t,e){var n;const r=function(){throw new Error("done() callback is deprecated, use promise instead")};return r.task=t,r.skip=()=>{throw t.pending=!0,new st("test is skipped; abort execution",t)},r.onTestFailed=o=>{t.onFailed||(t.onFailed=[]),t.onFailed.push(o)},r.onTestFinished=o=>{t.onFinished||(t.onFinished=[]),t.onFinished.push(o)},((n=e.extendTaskContext)==null?void 0:n.call(e,r))||r}function at(t,e){return`${t?"Hook":"Test"} timed out in ${e}ms.
If this is a long-running ${t?"hook":"test"}, pass a timeout value as the last argument or configure it globally with "${t?"hookTimeout":"testTimeout"}".`}function lt(t,e={}){const n=["auto"],r=Object.entries(t).map(([o,i])=>{const s={value:i};return Array.isArray(i)&&i.length>=2&&N(i[1])&&Object.keys(i[1]).some(c=>n.includes(c))&&(Object.assign(s,i[1]),s.value=i[0]),s.prop=o,s.isFn=typeof s.value=="function",s});return Array.isArray(e.fixtures)?e.fixtures=e.fixtures.concat(r):e.fixtures=r,r.forEach(o=>{if(o.isFn){const i=U(o.value);i.length&&(o.deps=e.fixtures.filter(({prop:s})=>s!==o.prop&&i.includes(s)))}}),e}const S=new Map,I=new Map;function V(t,e){return n=>{const r=n||e;if(!r)return t({});const o=nt(r);if(!(o!=null&&o.length))return t(r);const i=U(t),s=o.some(({auto:l})=>l);if(!i.length&&!s)return t(r);S.get(r)||S.set(r,new Map);const c=S.get(r);I.has(r)||I.set(r,[]);const a=I.get(r),h=o.filter(({prop:l,auto:p})=>p||i.includes(l)),g=H(h);if(!g.length)return t(r);async function y(){for(const l of g){if(c.has(l))continue;const p=l.isFn?await ft(l.value,r,a):l.value;r[l.prop]=p,c.set(l,p),a.unshift(()=>{c.delete(l)})}}return y().then(()=>t(r))}}async function ft(t,e,n){const r=q();let o=!1;const i=t(e,async s=>{o=!0,r.resolve(s);const c=q();n.push(async()=>{c.resolve(),await i}),await c}).catch(s=>{if(!o){r.reject(s);return}throw s});return r}function H(t,e=new Set,n=[]){return t.forEach(r=>{if(!n.includes(r)){if(!r.isFn||!r.deps){n.push(r);return}if(e.has(r))throw new Error(`Circular fixture dependency detected: ${r.prop} <- ${[...e].reverse().map(o=>o.prop).join(" <- ")}`);e.add(r),H(r.deps,e,n),n.push(r),e.clear()}}),n}function U(t){const e=t.toString().match(/[^(]*\(([^)]*)/);if(!e)return[];const n=$(e[1]);if(!n.length)return[];const r=n[0];if(!(r.startsWith("{")&&r.endsWith("}")))throw new Error(`The first argument inside a fixture must use object destructuring pattern, e.g. ({ test } => {}). Instead, received "${r}".`);const o=r.slice(1,-1).replace(/\s/g,""),i=$(o).map(c=>c.replace(/\:.*|\=.*/g,"")),s=i.at(-1);if(s&&s.startsWith("..."))throw new Error(`Rest parameters are not supported in fixtures, received "${s}".`);return i}function $(t){const e=[],n=[];let r=0;for(let i=0;i<t.length;i++)if(t[i]==="{"||t[i]==="[")n.push(t[i]==="{"?"}":"]");else if(t[i]===n[n.length-1])n.pop();else if(!n.length&&t[i]===","){const s=t.substring(r,i).trim();s&&e.push(s),r=i+1}const o=t.substring(r).trim();return o&&e.push(o),e}const A=vt(),ht=M(function(t,e,n){j().test.fn.call(this,T(t),e,n)}),_t=A,jt=ht;let b,pt,dt;function gt(){return dt}function mt(){return b}function j(){return F.currentSuite||pt}function yt(){return{beforeAll:[],afterAll:[],beforeEach:[],afterEach:[]}}function _(t,e){let n={},r=()=>{};if(typeof e=="object"){if(typeof t=="object")throw new TypeError("Cannot use two objects as arguments. Please provide options and a function callback in that order.");n=e}else typeof e=="number"?n={timeout:e}:typeof t=="object"&&(n=t);if(typeof t=="function"){if(typeof e=="function")throw new TypeError("Cannot use two functions as arguments. Please use the second argument for options.");r=t}else typeof e=="function"&&(r=e);return{options:n,handler:r}}function kt(t,e=()=>{},n,r,o,i){const s=[],c=[];let a;p();const h=function(d="",u={}){const f={id:"",name:d,suite:void 0,each:u.each,fails:u.fails,context:void 0,type:"custom",retry:u.retry??b.config.retry,repeats:u.repeats,mode:u.only?"only":u.skip?"skip":u.todo?"todo":"run",meta:u.meta??Object.create(null)},m=u.handler;(u.concurrent||!u.sequential&&b.config.sequence.concurrent)&&(f.concurrent=!0),r&&(f.shuffle=!0);const C=ut(f,b);if(Object.defineProperty(f,"context",{value:C,enumerable:!1}),et(C,u.fixtures),m&&tt(f,R(V(m,C),(u==null?void 0:u.timeout)??b.config.testTimeout)),b.config.includeTaskLocation){const E=Error.stackTraceLimit;Error.stackTraceLimit=15;const G=new Error("stacktrace").stack;Error.stackTraceLimit=E;const P=bt(G,f.each??!1);P&&(f.location=P)}return s.push(f),f},g=M(function(d,u,f){let{options:m,handler:C}=_(u,f);typeof i=="object"&&(m=Object.assign({},i,m)),m.concurrent=this.concurrent||!this.sequential&&(m==null?void 0:m.concurrent),m.sequential=this.sequential||!this.concurrent&&(m==null?void 0:m.sequential);const E=h(T(d),{...this,...m,handler:C});E.type="test"}),y={type:"collector",name:t,mode:n,options:i,test:g,tasks:s,collect:w,task:h,clear:k,on:l};function l(d,...u){ot(a)[d].push(...u)}function p(d){typeof i=="number"&&(i={timeout:i}),a={id:"",type:"suite",name:t,mode:n,each:o,shuffle:r,tasks:[],meta:Object.create(null),projectName:""},rt(a,yt())}function k(){s.length=0,c.length=0,p()}async function w(d){c.length=0,e&&await ct(y,()=>e(g));const u=[];for(const f of[...c,...s])u.push(f.type==="collector"?await f.collect(d):f);return a.file=d,a.tasks=u,u.forEach(f=>{f.suite=a,d&&(f.file=d)}),a}return it(y),y}function vt(){function t(e,n,r={}){const o=this.only?"only":this.skip?"skip":this.todo?"todo":"run",i=j();let{options:s,handler:c}=_(n,r);return i!=null&&i.options&&(s={...i.options,...s}),s.concurrent=this.concurrent||!this.sequential&&(s==null?void 0:s.concurrent),s.sequential=this.sequential||!this.concurrent&&(s==null?void 0:s.sequential),kt(T(e),c,o,this.shuffle,this.each,s)}return t.each=function(e,...n){const r=this.withContext();return this.setContext("each",!0),Array.isArray(e)&&n.length&&(e=B(e,n)),(o,i,s)=>{const c=T(o),a=e.every(Array.isArray),{options:h,handler:g}=_(i,s),y=typeof i=="function";e.forEach((l,p)=>{const k=Array.isArray(l)?l:[l];y?a?r(v(c,k,p),()=>g(...k),h):r(v(c,k,p),()=>g(l),h):a?r(v(c,k,p),h,()=>g(...k)):r(v(c,k,p),h,()=>g(l))}),this.setContext("each",void 0)}},t.skipIf=e=>e?A.skip:A,t.runIf=e=>e?A:A.skip,W(["concurrent","sequential","shuffle","skip","only","todo"],t)}function wt(t,e){const n=t;n.each=function(o,...i){const s=this.withContext();return this.setContext("each",!0),Array.isArray(o)&&i.length&&(o=B(o,i)),(c,a,h)=>{const g=T(c),y=o.every(Array.isArray),{options:l,handler:p}=_(a,h),k=typeof a=="function";o.forEach((w,d)=>{const u=Array.isArray(w)?w:[w];k?y?s(v(g,u,d),()=>p(...u),l):s(v(g,u,d),()=>p(w),l):y?s(v(g,u,d),l,()=>p(...u)):s(v(g,u,d),l,()=>p(w))}),this.setContext("each",void 0)}},n.skipIf=function(o){return o?this.skip:this},n.runIf=function(o){return o?this:this.skip},n.extend=function(o){const i=lt(o,e);return M(function(c,a,h){j().test.fn.call(this,T(c),a,h)},i)};const r=W(["concurrent","sequential","skip","only","todo","fails"],n);return e&&r.mergeContext(e),r}function M(t,e){return wt(t,e)}function T(t){return typeof t=="string"?t:t instanceof Function?t.name||"<anonymous>":String(t)}function v(t,e,n){t.includes("%#")&&(t=t.replace(/%%/g,"__vitest_escaped_%__").replace(/%#/g,`${n}`).replace(/__vitest_escaped_%__/g,"%%"));const r=t.split("%").length-1;let o=z(t,...e.slice(0,r));return N(e[0])&&(o=o.replace(/\$([$\w_.]+)/g,(i,s)=>{var c,a;return J(X(e[0],s),{truncate:(a=(c=void 0)==null?void 0:c.chaiConfig)==null?void 0:a.truncateThreshold})})),o}function B(t,e){const n=t.join("").trim().replace(/ /g,"").split(`
`).map(o=>o.split("|"))[0],r=[];for(let o=0;o<Math.floor(e.length/n.length);o++){const i={};for(let s=0;s<n.length;s++)i[n[s]]=e[o*n.length+s];r.push(i)}return r}function bt(t,e){const n=t.split(`
`).slice(1);for(const r of n){const o=Z(r);if(o&&o.file===gt())return{line:o.line,column:e?o.column+1:o.column}}}function Tt(){return mt().config.hookTimeout}function Et(t,e){return j().on("beforeEach",R(V(t),Tt(),!0))}export{Et as b,_t as d,Ft as g,jt as i};
//# sourceMappingURL=vitest_runner-CqFJvfZ7.js.map
